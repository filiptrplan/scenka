---
phase: 05-logger-form-reset
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [src/App.tsx, src/components/features/logger.tsx]
autonomous: true
---

<objective>
Auto-reset logger form after successful climb submission to reduce friction for logging multiple climbs in a session.

Purpose: Currently users must close and reopen the logger sheet after each climb. Keeping the sheet open and resetting the form allows quick successive logging, especially during training sessions.

Output: Logger form resets all fields to defaults but sheet stays open after successful submission.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/App.tsx
@src/components/features/logger.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add onResetComplete callback to Logger props</name>
  <files>src/components/features/logger.tsx</files>
  <action>
    Add `onResetComplete?: () => void` callback to LoggerProps interface. This callback will be invoked by parent when the form should reset after successful submission. This is a cleaner pattern than exposing the entire reset function.
  </action>
  <verify>TypeScript compiles with no errors for Logger component</verify>
  <done>onResetComplete callback exists in LoggerProps interface</done>
</task>

<task type="auto">
  <name>Task 2: Create resetAllState function in Logger</name>
  <files>src/components/features/logger.tsx</files>
  <action>
    Create `resetAllState()` function that resets all form and component states to defaults:

    1. Call react-hook-form's `reset()` with defaultValues
    2. Reset gradeScale to 'color_circuit'
    3. Reset discipline to 'boulder'
    4. Reset outcome to 'Fail'
    5. Reset awkwardness to 3
    6. Reset selectedStyles to empty array
    7. Reset selectedReasons to empty array

    This function should be exported via forwardRef or called directly when onResetComplete is invoked.

    Important: Only reset when onResetComplete is called (for successive climbs). Do NOT reset when sheet closes (current behavior should be preserved for edits/close).
  </action>
  <verify>resetAllState function exists and resets all 7 state variables</verify>
  <done>resetAllState resets form and all local component states</done>
</task>

<task type="auto">
  <name>Task 3: Update App.tsx to call reset instead of close</name>
  <files>src/App.tsx</files>
  <action>
    Modify handleClimbSubmit in App.tsx:

    For NEW climbs (not editing):
    - Keep loggerOpen true (do not close)
    - Call onResetComplete callback to reset form
    - Keep existing toast.success('Climb logged successfully')

    For EDITED climbs:
    - Keep existing behavior (close logger, setEditingClimb null, toast success)
    - No reset needed since editing closes the sheet

    Pass onResetComplete prop to Logger component:
    ```tsx
    <Logger
      open={loggerOpen}
      onOpenChange={handleLoggerClose}
      onSubmit={handleClimbSubmit}
      onResetComplete={() => {
        // Reset form for next climb
        // The implementation will be handled in Logger component
      }}
      isSaving={createClimb.isPending || updateClimb.isPending}
      climb={editingClimb}
    />
    ```

    Use react.forwardRef or expose a method to trigger reset from parent. The cleanest approach: pass a ref to Logger, use useImperativeHandle to expose resetAllState.
  </action>
  <verify>TypeScript compiles, Logger accepts onResetComplete callback</verify>
  <done>New climb submissions reset form but keep sheet open</done>
</task>

<task type="auto">
  <name>Task 4: Implement useImperativeHandle pattern for reset</name>
  <files>src/components/features/logger.tsx</files>
  <action>
    Since Logger uses Sheet with controlled open state, the most React-idiomatic approach:

    1. Change Logger to use forwardRef
    2. Use useImperativeHandle to expose resetAllState
    3. In App.tsx, create a ref to Logger
    4. After successful NEW climb submission, call loggerRef.current?.resetAllState()

    Implementation steps:
    - Add forwardRef to Logger export
    - Define LoggerHandle type with resetAllState method
    - Use useImperativeHandle to expose resetAllState
    - Create loggerRef in App.tsx using useRef<LoggerHandle>(null)
    - Pass ref to Logger component
    - In handleClimbSubmit success handler for new climbs: loggerRef.current?.resetAllState()

    This avoids prop drilling and follows React patterns for exposing imperative methods.
  </action>
  <verify>TypeScript compiles, loggerRef type is LoggerHandle | null</verify>
  <done>Logger exposes resetAllState via useImperativeHandle, App calls it after successful new climb</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Logger form now auto-resets after successful climb submission while keeping the sheet open</what-built>
  <how-to-verify>
    1. Run: pnpm dev
    2. Login to app
    3. Click + button to open logger sheet
    4. Fill in: Discipline (Boulder), Grade (5A), Outcome (Sent), Awkwardness (3), Style (Crimp), Location (Test Gym)
    5. Click LOG CLIMB
    6. Verify: Sheet stays open (does NOT close)
    7. Verify: All form fields reset to defaults (Boulder, Color circuit, Fail, Awkwardness 3, empty Style, empty Reasons, empty Notes, Location from profile)
    8. Log a second climb without closing sheet
    9. Verify: Both climbs appear in the climbs list
    10. Click Edit on first climb, make changes, click SAVE CHANGES
    11. Verify: Sheet closes (edit behavior unchanged)
  </how-to-verify>
  <resume-signal>Type "approved" or describe issues</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] pnpm typecheck passes with no errors
- [ ] pnpm build succeeds for production
- [ ] New climb submission keeps sheet open
- [ ] New climb submission resets all form fields
- [ ] Edit climb submission still closes sheet (existing behavior)
- [ ] Reset clears all 7 local state variables (gradeScale, discipline, outcome, awkwardness, selectedStyles, selectedReasons, form)
- [ ] Logger uses forwardRef with useImperativeHandle pattern
</verification>

<success_criteria>
- Logger form auto-resets after successful submission for new climbs
- Sheet remains open for successive logging
- Edit behavior unchanged (closes sheet)
- TypeScript compiles with no errors
- Production build succeeds
</success_criteria>

<output>
After completion, create `.planning/phases/05-logger-form-reset/05-01-SUMMARY.md`
</output>
