---
phase: 25-user-climbing-context-for-prompts
plan: 03
type: execute
wave: 2
depends_on: [25-01]
files_modified:
  - src/services/coach.ts
autonomous: true
user_setup: []

must_haves:
  truths:
    - "Profile includes climbing_context field in service"
    - "generateRecommendations fetches climbing_context from profile"
    - "climbing_context passed to Edge Function in request body"
  artifacts:
    - path: "src/services/coach.ts"
      provides: "Coach service integration with climbing context"
      contains: "climbing_context: profile?.climbing_context"
  key_links:
    - from: "generateRecommendations()"
      to: "openrouter-coach Edge Function"
      via: "request body"
      pattern: "climbing_context: profile\\.climbing_context"
    - from: "generateRecommendations()"
      to: "supabase.from('profiles').select()"
      via: "profile fetch"
      pattern: "profiles.*select"
---

<objective>
Update coach service to fetch and pass climbing_context to Edge Function.

Purpose: Wire the user-provided climbing context from profile to the AI coach recommendations generation.
Output: Updated coach service that includes climbing_context in Edge Function request.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/RESEARCH.md
@src/services/coach.ts
@src/types/index.ts
@src/services/profiles.ts
</context>

<tasks>

<task type="auto">
  <name>Update coach service to include climbing_context</name>
  <files>src/services/coach.ts</files>
  <action>
  Update generateRecommendations() function:
  1. After rate limit check, fetch user profile: const profile = await getProfile()
  2. Update Edge Function body to include climbing_context:
     body: {
       user_id: user.id,
       patterns_data: patterns,
       user_preferences: input.user_preferences,
       recent_climbs: recentClimbs,
       climbing_context: profile?.climbing_context,  // NEW FIELD
     }

  Import getProfile from @/services/profiles.

  The climbing_context field should be optional (null/undefined allowed) to support profiles without context.
  </action>
  <verify>
  pnpm typecheck
  </verify>
  <done>
  Coach service fetches profile and passes climbing_context to Edge Function in request body
  </done>
</task>

</tasks>

<verification>
Run type checking to verify:
- Profile type correctly imported
- climbing_context properly passed in request body
- No TypeScript errors in coach service
</verification>

<success_criteria>
1. getProfile() imported and called in generateRecommendations()
2. climbing_context added to request body
3. TypeScript compilation passes
4. Backward compatible with profiles without climbing_context
</success_criteria>

<output>
After completion, create `.planning/phases/25-user-climbing-context-for-prompts/25-03-SUMMARY.md`
</output>
