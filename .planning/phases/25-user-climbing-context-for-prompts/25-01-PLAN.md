---
phase: 25-user-climbing-context-for-prompts
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/types/index.ts
  - src/lib/validation.ts
autonomous: true
user_setup: []

must_haves:
  truths:
    - "Database migration adds climbing_context column to profiles table"
    - "Profile type includes climbing_context as optional string"
    - "profileSchema validates climbing_context with max 2000 characters"
  artifacts:
    - path: "supabase/migrations/20260119_add_climbing_context_to_profiles.sql"
      provides: "Database schema change for climbing context"
      contains: "ALTER TABLE public.profiles ADD COLUMN climbing_context TEXT"
    - path: "src/types/index.ts"
      provides: "TypeScript type safety for Profile"
      contains: "climbing_context: string | null"
    - path: "src/lib/validation.ts"
      provides: "Zod validation schema"
      contains: "climbing_context: z.string().max(2000).optional()"
  key_links:
    - from: "profileSchema"
      to: "Profile interface"
      via: "Type inference"
      pattern: "type UpdateProfileInput = z.infer<typeof profileSchema>"
---

<objective>
Add database migration, TypeScript types, and validation schema for user-provided climbing context.

Purpose: Create the data layer foundation allowing users to describe themselves as climbers, which will enhance AI coach personalization.
Output: Database migration file, updated Profile type, and profileSchema validation.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/RESEARCH.md
@src/types/index.ts
@src/lib/validation.ts
</context>

<tasks>

<task type="auto">
  <name>Create database migration for climbing_context</name>
  <files>supabase/migrations/20260119_add_climbing_context_to_profiles.sql</files>
  <action>
  Create migration file with:
  1. Add climbing_context TEXT column to public.profiles table
  2. Add check constraint: climbing_context IS NULL OR length(climbing_context) <= 2000

  Follow existing migration patterns from Phase 18-01.

  Do NOT add default value - column should be nullable to support existing users.
  </action>
  <verify>
  npx supabase db push
  </verify>
  <done>
  Migration runs successfully without errors, climbing_context column exists in profiles table
  </done>
</task>

<task type="auto">
  <name>Add climbing_context to Profile type</name>
  <files>src/types/index.ts</files>
  <action>
  Update Profile interface (around line 289-298):
  1. Add climbing_context: string | null to Profile Row type
  2. Add climbing_context?: string | null to Profile Insert type
  3. Add climbing_context?: string | null to Profile Update type

  Match the pattern of existing nullable fields like home_gym.
  </action>
  <verify>
  pnpm typecheck
  </verify>
  <done>
  Profile interface includes climbing_context field with proper nullability, no TypeScript errors
  </done>
</task>

<task type="auto">
  <name>Add climbing_context to profileSchema</name>
  <files>src/lib/validation.ts</files>
  <action>
  Update profileSchema (around line 82-88):
  Add climbing_context field: z.string().max(2000).optional()

  Place after close_logger_after_add field (maintain field order for consistency).
  </action>
  <verify>
  pnpm typecheck && grep "climbing_context" src/lib/validation.ts
  </verify>
  <done>
  profileSchema validates climbing_context with max 2000 characters, validation passes
  </done>
</task>

</tasks>

<verification>
Run database migration and verify schema changes:
- pnpm typecheck passes
- Database shows climbing_context column in profiles table
- Profile type and validation schema include climbing_context field
</verification>

<success_criteria>
1. Database migration applied successfully
2. TypeScript types updated with climbing_context field
3. Validation schema enforces 2000 character limit
4. All existing tests pass
5. No TypeScript errors in codebase
</success_criteria>

<output>
After completion, create `.planning/phases/25-user-climbing-context-for-prompts/25-01-SUMMARY.md`
</output>
