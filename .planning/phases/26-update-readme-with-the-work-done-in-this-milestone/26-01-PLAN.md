---
phase: 26-update-readme-with-the-work-done-in-this-milestone
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - README.md
autonomous: true

must_haves:
  truths:
    - "User can find 'AI Coach' section in README after reading about core features"
    - "User understands what AI Coach features are available"
    - "User knows how to set up AI Coach (Edge Functions, env vars, migrations)"
    - "User understands privacy safeguards and data handling"
    - "User knows how to use AI Coach features (generate recommendations, chat, configure context)"
    - "Existing users know how to upgrade from v1.1 to v2.0"
    - "User can find technical details about database schema and Edge Functions"
  artifacts:
    - path: "README.md"
      provides: "Complete documentation including AI Coach features"
      contains: "## AI Coach"
      contains: "### v1.1 to v2.0 Upgrade"
      contains: "## AI Coach Technical Details"
  key_links:
    - from: "AI Coach Setup section"
      to: "STATE.md blockers"
      via: "Edge Function deployment and env var commands"
      pattern: "supabase functions deploy|supabase secrets set"
    - from: "AI Coach Technical Details"
      to: "supabase/migrations/"
      via: "Database schema reference"
      pattern: "coach_recommendations|coach_messages|climbing_context"
---

<objective>
Update README.md with comprehensive documentation of AI Coach features added in v2.0

Purpose: Document the AI-powered climbing coach features (phases 18-25) so users understand capabilities, setup requirements, privacy safeguards, and how to use them
Output: Updated README.md with new AI Coach section, upgrade instructions, and technical details
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/ROADMAP.md
@.planning/phases/26-update-readme-with-the-work-done-in-this-milestone/26-RESEARCH.md
@README.md

# Feature Summary (phases 18-25)
- Phase 18: Database tables (coach_recommendations, coach_messages, coach_api_usage) with cost tracking and privacy safeguards
- Phase 19: Coach UI with recommendations display, pattern analysis, and tabbed interface
- Phase 20: LLM integration via OpenRouter API through Edge Functions
- Phase 21: Chat interface with SSE streaming and message history
- Phase 22: OpenRouter model configuration via OPENROUTER_MODEL env var
- Phase 23: Technique-focused coaching philosophy with measurable_outcome drills
- Phase 24: Projecting focus recommendations for weekly boulder selection
- Phase 25: User climbing context (custom instructions like ChatGPT)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add AI Coach section to README.md</name>
  <files>README.md</files>
  <action>
  Add new "AI Coach" section after "What Makes Scenka Different" and before "Tech Stack" with the following subsections:

  ## AI Coach (New in v2.0) ðŸ§ 

  Scenka includes an AI-powered climbing coach that analyzes your logged data to provide personalized training guidance. Focuses on technique development with privacy-first design and climbing-specific domain knowledge.

  **Features:**
  - Weekly Focus: Personalized 1-2 sentence focus based on your failure patterns
  - Training Drills: 3 specific technique drills with sets, reps, and measurable outcomes
  - Pattern Analysis: Visual breakdown of failure reasons, style weaknesses, and climbing frequency
  - Chat Interface: Free-form Q&A with streaming responses for deeper learning
  - Projecting Focus: Suggestions for what to climb each week based on weaknesses
  - Climbing Context: Customizable context (like ChatGPT custom instructions) for personalized coaching

  ### Privacy Safeguards

  Your climbing data never leaves without anonymization:
  - Gym names and crags anonymized before LLM processing (indoor_gym, outdoor_crags)
  - Profile data (email, name) never included in LLM requests
  - Row Level Security ensures users can only access their own recommendations
  - Recent climb notes filtered for PII (>200 character threshold with runtime validation)
  - All data sent to OpenRouter via secure Edge Functions (no client-side API calls)

  ### Setup Instructions

  To enable AI Coach features, set up OpenRouter and deploy Edge Functions:

  1. Get OpenRouter API key:
     - Sign up at [openrouter.ai](https://openrouter.ai)
     - Generate API key from dashboard

  2. Set OpenRouter secrets in Supabase:
     ```bash
     supabase secrets set OPENROUTER_API_KEY=your_key_here
     supabase secrets set OPENROUTER_MODEL=google/gemini-2.5-pro
     ```

  3. Deploy Edge Functions:
     ```bash
     supabase functions deploy openrouter-coach
     supabase functions deploy openrouter-chat
     ```

  4. Apply database migrations (adds coach tables and climbing_context):
     ```bash
     npx supabase db push
     ```

  ### Usage

  1. Log at least 3-5 climbs with detailed tags and failure reasons
  2. Navigate to Coach tab
  3. Click "Generate Recommendations" to get weekly focus, drills, and pattern analysis
  4. Add climbing context in Settings (optional): Describe your climbing style, goals, preferences
  5. Click "Ask Coach a Question" to chat about specific techniques, drills, or climbing concepts
  6. Regenerate recommendations weekly for fresh analysis

  <!-- TODO: Capture screenshot from app -->
  ![Screenshot: Coach page with weekly focus, training drills, and pattern analysis tabs](./docs/screenshots/coach-page.png)

  *[Capture from: Navigate to Coach tab, showing Recommendations tab with Weekly Focus, Training Drills, Projecting Focus sections, and Pattern Analysis tab with failure patterns, style weaknesses, and climbing frequency]*

  <!-- TODO: Capture screenshot from app -->
  ![Screenshot: Chat interface with streaming conversation about climbing technique](./docs/screenshots/chat-page.png)

  *[Capture from: Click "Ask Coach a Question" from coach page, showing chat interface with user/assistant message bubbles, streaming indicator, and text input]*

  Important: Do NOT add screenshots yet - add TODO comments as shown above since docs/screenshots/ directory may not exist.
  </action>
  <verify>
  Check README.md contains:
  - "## AI Coach (New in v2.0)" heading
  - Features list with 6 bullet points
  - "### Privacy Safeguards" subsection with 5 privacy guarantees
  - "### Setup Instructions" subsection with code blocks for secrets, deployment, and migrations
  - "### Usage" subsection with 6 steps
  - Two screenshot TODO comments with descriptive captions
  </verify>
  <done>
  AI Coach section added to README with features, privacy safeguards, setup instructions, usage steps, and screenshot placeholders
  </done>
</task>

<task type="auto">
  <name>Task 2: Add v1.1 to v2.0 Upgrade section and Technical Details</name>
  <files>README.md</files>
  <action>
  Add two new sections to README.md:

  ### v1.1 to v2.0 Upgrade

  Existing users upgrading to v2.0:

  1. Apply database migrations:
     ```bash
     npx supabase db push
     ```
     This adds coach tables and the climbing_context column to profiles table.

  2. Set up OpenRouter:
     - Get API key from [openrouter.ai](https://openrouter.ai)
     - Set secrets: `supabase secrets set OPENROUTER_API_KEY=your_key_here`
     - Set model: `supabase secrets set OPENROUTER_MODEL=google/gemini-2.5-pro`

  3. Deploy Edge Functions:
     ```bash
     supabase functions deploy openrouter-coach
     supabase functions deploy openrouter-chat
     ```

  That's it! Your existing climb data will be analyzed by the coach automatically.

  ---

  ## AI Coach Technical Details

  ### Database Schema

  The AI Coach uses three new tables:

  - **coach_recommendations**: Stores weekly focus, drills, projecting focus, and metadata (generation_date, is_cached)
  - **coach_messages**: Stores chat conversation history with SSE streaming support
  - **coach_api_usage**: Tracks token usage and costs for rate limiting (50k tokens/day per user)
  - **profiles.climbing_context**: Optional custom context (2000 char limit) for personalization

  All tables use JSONB columns for flexible schema evolution and include RLS policies for user isolation.

  ### Edge Functions

  Two Supabase Edge Functions handle LLM communication:

  - **openrouter-coach**: Generates weekly recommendations based on pattern analysis and recent climbs
  - **openrouter-chat**: Streams chat responses with climbing-specific domain knowledge

  Functions validate JWT tokens, anonymize data before OpenRouter API calls, validate LLM responses against climbing best practices, and store results in Supabase.

  ### Rate Limiting

  Each user limited to 50k tokens/day (~15-20 recommendation generations or 50-100 chat messages) to balance utility with cost control. Usage tracked in coach_api_usage table with real-time enforcement in Edge Functions.

  ### Privacy Architecture

  Data flow:
  1. Client fetches climbs and patterns from Supabase (user data stays in Supabase)
  2. Anonymization removes gym names, crags, and PII before Edge Function call
  3. Edge Function validates JWT and sends anonymized data to OpenRouter
  4. OpenRouter returns JSON response validated against climbing schema
  5. Recommendations/messages stored in Supabase with RLS (user can only access their own)

  Reference migration files for full schema:
  - `supabase/migrations/20260117132100_create_coach_tables.sql`
  - `supabase/migrations/20260118081500_add_coach_api_usage_insert_policy.sql`
  - `supabase/migrations/20260119191600_add_climbing_context_to_profiles.sql`

  Place these sections at the end of README.md before the final "Built with love" line. Add the v1.1 to v2.0 Upgrade section after the existing Development Notes section. Add the AI Coach Technical Details section after the Upgrade section.
  </action>
  <verify>
  Check README.md contains:
  - "### v1.1 to v2.0 Upgrade" heading with 3 steps
  - "## AI Coach Technical Details" heading
  - "### Database Schema" subsection listing 4 tables
  - "### Edge Functions" subsection describing openrouter-coach and openrouter-chat
  - "### Rate Limiting" subsection explaining 50k tokens/day limit
  - "### Privacy Architecture" subsection with 5-step data flow
  - Migration file references
  </verify>
  <done>
  v1.1 to v2.0 Upgrade section and AI Coach Technical Details section added to README.md with complete technical documentation
  </done>
</task>

</tasks>

<verification>
After completing tasks, verify:
- [ ] README.md includes new "AI Coach" section after "What Makes Scenka Different"
- [ ] README.md includes v1.1 to v2.0 Upgrade section with clear migration steps
- [ ] README.md includes AI Coach Technical Details section
- [ ] All code blocks use proper bash syntax highlighting
- [ ] Screenshot TODO comments include descriptive captions
- [ ] Privacy safeguards clearly explained
- [ ] Setup instructions include all required commands from STATE.md blockers
- [ ] Migration file references are correct
- [ ] No "NEW in v2.0" badges needed (already handled by section placement)
- [ ] README markdown structure is valid
</verification>

<success_criteria>
- [ ] README.md comprehensively documents AI Coach features
- [ ] Users can set up AI Coach by following README instructions
- [ ] Users understand privacy safeguards before using features
- [ ] Existing users can upgrade from v1.1 to v2.0
- [ ] Technical details available for developers
- [ ] Screenshots documented with TODO comments (actual capture deferred)
</success_criteria>

<output>
After completion, create `.planning/phases/26-update-readme-with-the-work-done-in-this-milestone/26-01-SUMMARY.md`
</output>
