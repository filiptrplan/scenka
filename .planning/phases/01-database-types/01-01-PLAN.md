---
phase: 01-database-types
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - supabase/migrations/20260115XXXXXX_add_hold_color.sql
  - src/types/index.ts
  - src/lib/validation.ts
autonomous: true
---

<objective>
Add hold_color database column to climbs table and update TypeScript types with Zod validation.

Purpose: Enable storage of hold color data with each climb, establishing the foundation for color selection and display features.

Output:
- Migration file adding hold_color column to climbs table
- Updated Database types with hold_color field
- Updated Climb type and Zod schema for hold_color validation
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Existing database schema and patterns
@supabase/migrations/20260105175622_create_climbs_table.sql

# Existing type definitions
@src/types/index.ts

# Existing validation patterns
@src/lib/validation.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create migration adding hold_color column to climbs table</name>
  <files>supabase/migrations/20260115XXXXXX_add_hold_color.sql</files>
  <action>
Create a new Supabase migration file with timestamp 20260115XXXXXX (use current time).

Add `hold_color` TEXT column to the public.climbs table:
- Column type: TEXT (nullable - allow NULL for backward compatibility with existing climbs)
- Add CHECK constraint to validate allowed colors
- Allowed values: 'red', 'green', 'blue', 'yellow', 'black', 'white', 'orange', 'purple', 'pink'
- Column should be nullable to not break existing climbs without color data
- No RLS policy changes needed (existing policies cover new column)

Follow existing migration pattern from climbs table creation (see reference migration).

Migration file format:
```sql
-- Add hold_color column to climbs table
ALTER TABLE public.climbs
ADD COLUMN hold_color TEXT CHECK (hold_color IN ('red', 'green', 'blue', 'yellow', 'black', 'white', 'orange', 'purple', 'pink'));

-- Add comment for documentation
COMMENT ON COLUMN public.climbs.hold_color IS 'Hold color selected by user when logging climb';
```

Use npx supabase migration new command or create file manually with proper timestamp format.
  </action>
  <verify>
Run: `npx supabase db push` to apply migration locally
Verify: `npx supabase db remote changes` shows pending migration
  </verify>
  <done>
Migration file created with proper timestamp
Migration adds hold_color column with CHECK constraint
Migration applies successfully to local database
  </done>
</task>

<task type="auto">
  <name>Task 2: Update TypeScript types and Zod validation</name>
  <files>src/types/index.ts, src/lib/validation.ts</files>
  <action>
1. Update src/types/index.ts:
   - Add hold_color field to Database['public']['Tables']['climbs']['Row']
   - Add hold_color to Insert type (as optional string)
   - Add hold_color to Update type (as optional string)
   - Export new type: `export type HoldColor = 'red' | 'green' | 'blue' | 'yellow' | 'black' | 'white' | 'orange' | 'purple' | 'pink'`
   - Update Climb type to include hold_color: `hold_color?: HoldColor`

2. Update src/lib/validation.ts:
   - Add hold_color field to climbSchema
   - Use z.enum() with the 9 allowed color values
   - Make field optional with .optional() for backward compatibility
   - Place after grade_value field, before style field

Follow existing patterns in both files (see reference files for style).

After changes, regenerate Supabase types if needed: `npx supabase gen types typescript --local > src/types/supabase.ts` (if using generated types file)
  </action>
  <verify>
Run: `pnpm typecheck` - no TypeScript errors
Run: `pnpm lint` - no linting errors
Verify: Database types include hold_color field in Row, Insert, Update
Verify: Climb type includes optional hold_color property
Verify: climbSchema includes optional hold_color z.enum validation
  </verify>
  <done>
HoldColor type exported with 9 color values
Database types updated for climbs table (Row, Insert, Update)
Climb type includes optional hold_color property
climbSchema includes hold_color field with proper validation
TypeScript compilation succeeds
  </done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Migration file created with proper timestamp format (YYYYMMDDHHMMSS)
- [ ] Migration applies successfully with `npx supabase db push`
- [ ] `pnpm typecheck` passes with no errors
- [ ] `pnpm lint` passes with no errors
- [ ] HoldColor type is exported and used in Database and Climb types
- [ ] climbSchema includes hold_color with z.enum validation
</verification>

<success_criteria>

- Migration adds hold_color column with CHECK constraint for 9 colors
- TypeScript types updated across Database types and Climb interface
- Zod validation schema includes optional hold_color field
- All type checking passes
- Existing climbs without color data remain valid (NULL allowed)
</success_criteria>

<output>
After completion, create `.planning/phases/01-database-types/01-01-SUMMARY.md` with:
- Migration timestamp and file path
- Database schema changes (hold_color column added)
- Type system changes (HoldColor type, Database types, Climb type)
- Validation changes (climbSchema updated)
- Any issues encountered and how they were resolved
- Verification that existing data remains valid (backward compatibility)
</output>
