---
phase: 24-projecting-focus-recommendations
plan: 02
type: execute
wave: 2
depends_on: ["24-01"]
files_modified:
  - src/services/coach.ts
autonomous: true
user_setup: []

must_haves:
  truths:
    - "Client can access projecting_focus from GenerateRecommendationsResponse without runtime errors"
    - "User sees all four fields (focus_area, description, grade_guidance, rationale) for each projecting focus area"
    - "Old cached recommendations without projecting_focus field don't cause runtime errors"
  artifacts:
    - path: "src/services/coach.ts"
      provides: "Type-safe client-side API service for coach recommendations"
      exports: ["ProjectingFocus", "GenerateRecommendationsResponse"]
  key_links:
    - from: "generateRecommendations()"
      to: "openrouter-coach Edge Function"
      via: "Supabase function invoke"
      pattern: "supabase.functions.invoke.*openrouter-coach"
    - from: "GenerateRecommendationsResponse"
      to: "Edge Function response structure"
      via: "Type synchronization"
      pattern: "weekly_focus|drills|projecting_focus"
---

<objective>
Update TypeScript type definitions to include projecting focus field in client-side service.

Purpose: Ensure type safety when accessing projecting_focus data from Edge Function responses, preventing runtime errors from missing or malformed fields.
Output: Extended GenerateRecommendationsResponse interface with ProjectingFocus type definition.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@.planning/phases/24-projecting-focus-recommendations/24-CONTEXT.md
@.planning/phases/24-projecting-focus-recommendations/24-RESEARCH.md

@src/services/coach.ts
</context>

<tasks>

<task type="auto">
  <name>Add ProjectingFocus interface and extend GenerateRecommendationsResponse</name>
  <files>src/services/coach.ts</files>
  <action>
    In src/services/coach.ts, update type definitions:

    1. Add ProjectingFocus interface before GenerateRecommendationsResponse (around line 25):
    ```typescript
    export interface ProjectingFocus {
      focus_area: string
      description: string
      grade_guidance: string
      rationale: string
    }
    ```

    2. Extend GenerateRecommendationsResponse interface to include projecting_focus:
    ```typescript
    export interface GenerateRecommendationsResponse {
      weekly_focus: string
      drills: Array<{
        name: string
        description: string
        sets: number
        reps: string
        rest: string
        measurable_outcome: string
      }>
      projecting_focus: ProjectingFocus[]
    }
    ```

    This matches the Edge Function response structure defined in Phase 24-01.

    NOTE: Do NOT modify GenerateRecommendationsInput interface or any other types - only add ProjectingFocus and extend GenerateRecommendationsResponse.
  </action>
  <verify>
    grep -A 5 "export interface ProjectingFocus" src/services/coach.ts
  </verify>
  <done>
    ProjectingFocus interface defined with focus_area, description, grade_guidance, and rationale fields; GenerateRecommendationsResponse includes projecting_focus: ProjectingFocus[]
  </done>
</task>

<task type="auto">
  <name>Update generateRecommendations to return projecting_focus</name>
  <files>src/services/coach.ts</files>
  <action>
    In src/services/coach.ts, update generateRecommendations function return statement (around line 157):

    Change:
    ```typescript
    return {
      weekly_focus: parsed_data.content.weekly_focus,
      drills: parsed_data.content.drills,
    } as GenerateRecommendationsResponse
    ```

    To:
    ```typescript
    return {
      weekly_focus: parsed_data.content.weekly_focus,
      drills: parsed_data.content.drills,
      projecting_focus: parsed_data.content.projecting_focus || [],
    } as GenerateRecommendationsResponse
    ```

    The `|| []` fallback ensures backward compatibility with old cached recommendations that don't have projecting_focus field (prevents runtime errors).
  </action>
  <verify>
    grep "projecting_focus: parsed_data.content.projecting_focus" src/services/coach.ts
  </verify>
  <done>
    generateRecommendations returns projecting_focus from API response with empty array fallback for backward compatibility
  </done>
</task>

</tasks>

<verification>
1. ProjectingFocus interface defined in src/services/coach.ts with all required fields (focus_area, description, grade_guidance, rationale)
2. GenerateRecommendationsResponse interface includes projecting_focus: ProjectingFocus[]
3. generateRecommendations function returns projecting_focus from API response with empty array fallback
4. Type check passes: `pnpm typecheck` returns no errors
</verification>

<success_criteria>
TypeScript types updated to include projecting_focus field with backward compatibility for old cached recommendations.
</success_criteria>

<output>
After completion, create `.planning/phases/24-projecting-focus-recommendations/24-02-SUMMARY.md`
</output>
