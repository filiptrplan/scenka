---
phase: 03-logger-integration
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [src/components/features/logger.tsx]
autonomous: true
---

<objective>
Add hold color picker field to climb logging form using user's enabled colors.

Purpose: Allow climbers to record hold colors when logging climbs, integrating with the color preferences configured in settings.

Output: Color picker UI in logger that only shows enabled colors from user profile, stores selected color with climb.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@.planning/phases/01-database-types/01-01-SUMMARY.md
@.planning/phases/02-settings-page/02-01-SUMMARY.md
@.planning/phases/02-settings-page/02-02-SUMMARY.md

@src/components/features/logger.tsx
@src/components/features/color-settings.tsx
@src/types/index.ts
@src/lib/validation.ts
@src/lib/constants.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add hold color state management to logger</name>
  <files>src/components/features/logger.tsx</files>
  <action>
    Add state management for hold_color selection:

    1. Add `selectedColor` state with `useState<HoldColor | undefined>(undefined)`
    2. Add `hold_color` to form defaultValues as `undefined`
    3. Add `hold_color` to reset effect when editing existing climb (from climb.hold_color)
    4. Create `setSelectedColor` helper to update both state and form value with `setValue('hold_color', color, { shouldValidate: true })`
    5. Add `watch('hold_color')` to track form value changes
    6. Import `HoldColor` type from '@/types'

    Pattern: Follow existing state management for discipline, outcome, awkwardness (useState + setValue sync)
  </action>
  <verify>TypeScript compiles without errors, hold_color state is typed correctly</verify>
  <done>Hold color state is managed alongside other form fields with proper type safety</done>
</task>

<task type="auto">
  <name>Task 2: Create color picker UI with enabled colors filter</name>
  <files>src/components/features/logger.tsx</files>
  <action>
    Create color picker UI section that displays only enabled colors:

    1. Add new section after "Grade" section, before "Outcome" section (line ~256)
    2. Use `profile?.enabled_hold_colors` to filter available colors (from existing useProfile hook at line 37)
    3. Create colorMap object inline matching ColorSettings component hex values:
       ```typescript
       const colorMap: Record<HoldColor, string> = {
         red: '#ef4444', green: '#22c55e', blue: '#3b82f6', yellow: '#eab308',
         black: '#000000', white: '#ffffff', orange: '#f97316', purple: '#a855f7', pink: '#ec4899'
       }
       ```
    4. Render 3-column grid of color buttons (only enabled colors from profile)
    5. Use button styling similar to ColorSettings: h-14 w-full rounded-lg border-2, inline backgroundColor style
    6. Show selected state with ring-2 ring-white ring-offset-2 ring-offset-[#0a0a0a], unselected with opacity-40 hover:opacity-70
    7. Add label: "Hold Color (optional)" with same label style as other sections
    8. Handle case when enabled_hold_colors is empty/null (don't render section or show all colors)

    Pattern: Follow ColorSettings component styling for visual consistency
  </action>
  <verify>Color picker renders with correct colors, selection state updates visually, TypeScript compiles</verify>
  <done>Color picker displays only enabled colors from profile, selection updates form state</done>
</task>

<task type="auto">
  <name>Task 3: Verify form submission and persistence</name>
  <files>src/components/features/logger.tsx</files>
  <action>
    Verify that hold_color is properly included in form submission:

    1. Confirm `handleFormSubmit` (line 114) passes hold_color in onSubmit data (automatic via useForm)
    2. Test form reset clears selectedColor state
    3. Verify climbSchema validation allows optional hold_color (already in validation.ts:16)
    4. Ensure no validation errors when hold_color is undefined (field is optional)

    Pattern: hold_color is optional in schema (z.enum().optional()), no changes needed to validation
  </action>
  <verify>
    Run `pnpm typecheck` - no errors
    Run `pnpm build` - production build succeeds
    Form submission includes hold_color field when selected
  </verify>
  <done>Form submission includes hold_color value, optional field works correctly</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `pnpm typecheck` passes with no errors
- [ ] `pnpm build` succeeds for production
- [ ] Color picker only shows enabled colors from user profile
- [ ] Selecting a color updates the form state
- [ ] Form submission includes hold_color when selected
- [ ] Editing an existing climb with hold_color loads the color correctly
- [ ] Form reset clears the color selection
</verification>

<success_criteria>

- Hold color picker UI added to logger form
- Only displays colors enabled in user settings (profile.enabled_hold_colors)
- Color selection stores correctly with climb data
- Form validation allows optional hold_color field
- Existing climb editing loads hold_color value correctly
  </success_criteria>

<output>
After completion, create `.planning/phases/03-logger-integration/03-01-SUMMARY.md`
</output>
