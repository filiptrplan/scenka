---
phase: 02-settings-page
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - supabase/migrations/YYYYMMDDHHMMSS_add_enabled_hold_colors.sql
  - src/types/index.ts
  - src/lib/validation.ts
autonomous: true
---

<objective>
Add database support and type definitions for storing user's enabled hold colors preference.

Purpose: Enable persistence of which hold colors each user has enabled in their profile, forming the data foundation for the color settings UI.

Output: Database migration, updated TypeScript types, and Zod validation schema for enabled_hold_colors field.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-database-types/01-01-SUMMARY.md
@.planning/phases/02-settings-page/DISCOVERY.md

@src/types/index.ts
@src/lib/validation.ts
@src/services/profiles.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create database migration for enabled_hold_colors column</name>
  <files>supabase/migrations/YYYYMMDDHHMMSS_add_enabled_hold_colors.sql</files>
  <action>Create a new Supabase migration file that adds an enabled_hold_colors TEXT[] column to the profiles table.

**Column specification:**
- Type: TEXT[] (array of text)
- Default: ARRAY['red', 'green', 'blue', 'yellow', 'orange', 'purple', 'pink']::TEXT[]
- Nullable: No (always has a value)
- Documentation: Comment explaining this stores user's enabled hold color preferences

**Migration filename:** Use timestamp format YYYYMMDDHHMMSS (e.g., 20260115170000_add_enabled_hold_colors.sql)

**Default colors rationale:** Exclude black and white from defaults (less common as primary hold colors), include all others. Users can enable/disable any colors in settings.

**Apply migration:** After creating the file, run `npx supabase db push` to apply to local database.

**Pattern reference:** Follow the same pattern as Phase 01-01's hold_color migration (see .planning/phases/01-database-types/01-01-SUMMARY.md).</action>
  <verify>
    Run `npx supabase db push` and verify:
    - Migration applies successfully
    - Column exists in profiles table: check with `npx supabase db remote tables list --linked profiles`
    - Default value is set correctly
  </verify>
  <done>Migration created and applied, profiles table has enabled_hold_colors column with TEXT[] type and default array of 7 colors</done>
</task>

<task type="auto">
  <name>Task 2: Update TypeScript types for Profile interface</name>
  <files>src/types/index.ts</files>
  <action>Update the Profile type and Database types to include the new enabled_hold_colors field.

**Changes needed:**

1. Add to `Database.public.Tables.profiles.Row` interface:
```typescript
enabled_hold_colors: string[]
```

2. Add to `Database.public.Tables.profiles.Insert` interface:
```typescript
enabled_hold_colors?: string[]
```
(Make optional for inserts to allow default value)

3. Add to `Database.public.Tables.profiles.Update` interface:
```typescript
enabled_hold_colors?: string[]
```

4. Add to the `Profile` type in domain types (if it exists as a separate interface):
```typescript
export interface Profile {
  id: string
  preferred_grade_scale: GradeScale
  preferred_discipline: Discipline
  home_gym: string | null
  onboarding_completed: boolean
  updated_at: string
  enabled_hold_colors: HoldColor[]  // NEW FIELD - use HoldColor union type
}
```

**Important:** The Profile interface should use the existing `HoldColor` type (created in Phase 01-01) as an array: `HoldColor[]` not `string[]`.

**Pattern reference:** Follow the same pattern as other profile fields (preferred_grade_scale, preferred_discipline).</action>
  <verify>
    Run `pnpm typecheck` and verify:
    - No TypeScript errors
    - Profile type includes enabled_hold_colors with proper type safety
    - Database types are consistent with migration
  </verify>
  <done>Profile interface includes enabled_hold_colors: HoldColor[] field, all TypeScript type checking passes</done>
</task>

<task type="auto">
  <name>Task 3: Update Zod validation schema for profile</name>
  <files>src/lib/validation.ts</files>
  <action>Update the profileSchema in src/lib/validation.ts to include validation for the enabled_hold_colors field.

**Schema addition:**
```typescript
enabled_hold_colors: z.array(z.enum(['red', 'green', 'blue', 'yellow', 'black', 'white', 'orange', 'purple', 'pink'])).default(DEFAULT_COLORS)
```

**Placement:** Add after the `home_gym` field, before the closing brace of the profileSchema object.

**Define DEFAULT_COLORS constant:**
Add at the top of the file (after imports):
```typescript
const DEFAULT_COLORS: HoldColor[] = ['red', 'green', 'blue', 'yellow', 'orange', 'purple', 'pink']
```

**Important:** The enum must match all 9 HoldColor values exactly (order doesn't matter for enum, but keep consistent).

**Export the updated type:**
The UpdateProfileInput type will automatically include the new field through `z.infer`.

**Pattern reference:** Follow the same pattern as other profile fields (preferred_grade_scale, home_gym).</action>
  <verify>
    Run `pnpm typecheck` and verify:
    - UpdateProfileInput type includes enabled_hold_colors
    - Zod validation accepts arrays of valid HoldColor values
    - Zod validation rejects invalid color names
    - Default value is correctly applied

    Test with:
    ```typescript
    import { profileSchema } from '@/lib/validation'
    profileSchema.parse({ enabled_hold_colors: ['red', 'green'] }) // should pass
    profileSchema.parse({ enabled_hold_colors: ['invalid'] }) // should throw
    ```
  </verify>
  <done>profileSchema includes enabled_hold_colors array validation with Zod enum, default value of 7 colors, TypeScript types update correctly</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Migration created with proper timestamp format
- [ ] `npx supabase db push` applies migration successfully
- [ ] TypeScript types updated in src/types/index.ts (Profile interface + Database types)
- [ ] Zod validation updated in src/lib/validation.ts (profileSchema)
- [ ] `pnpm typecheck` passes with no errors
- [ ] All type definitions are consistent across migration, types, and validation
</verification>

<success_criteria>

- Database migration adds enabled_hold_colors TEXT[] column to profiles table with default array of 7 colors
- TypeScript Profile interface includes enabled_hold_colors: HoldColor[] field
- Database types (Row/Insert/Update) include enabled_hold_colors field
- Zod profileSchema validates enabled_hold_colors as array of HoldColor enum values
- Default value matches migration default (7 colors excluding black/white)
- All type checking passes
- No breaking changes to existing profile functionality
  </success_criteria>

<output>
After completion, create `.planning/phases/02-settings-page/02-01-SUMMARY.md`
</output>
