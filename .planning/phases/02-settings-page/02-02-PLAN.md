---
phase: 02-settings-page
plan: 02
type: execute
wave: 2
depends_on:
  - 02-01
files_modified:
  - src/components/features/color-settings.tsx
  - src/components/features/settings-page.tsx
autonomous: true
---

<objective>
Build a color settings UI component that allows users to enable/disable hold colors and integrate it into the existing settings page.

Purpose: Provide an intuitive, mobile-friendly interface for users to customize which hold colors appear in their climb logging flow.

Output: New ColorSettings component with color grid UI, integrated into settings page with form persistence.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
@~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-settings-page/DISCOVERY.md
@.planning/phases/02-settings-page/02-01-SUMMARY.md

@src/components/features/settings-page.tsx
@src/types/index.ts
@src/lib/validation.ts
@src/hooks/useProfile.ts
@.planning/codebase/CONVENTIONS.md
@.planning/codebase/STRUCTURE.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ColorSettings component with color grid</name>
  <files>src/components/features/color-settings.tsx</files>
  <action>Create a new ColorSettings component that displays a 3x3 grid of color chips with toggle functionality.

**Component specification:**

```typescript
interface ColorSettingsProps {
  value: HoldColor[]  // Currently enabled colors
  onChange: (colors: HoldColor[]) => void  // Update handler
}

export function ColorSettings({ value, onChange }: ColorSettingsProps) {
  // Color map for display (inline styles with hex values)
  const colorMap: Record<HoldColor, string> = {
    red: '#ef4444',
    green: '#22c55e',
    blue: '#3b82f6',
    yellow: '#eab308',
    black: '#000000',
    white: '#ffffff',
    orange: '#f97316',
    purple: '#a855f7',
    pink: '#ec4899',
  }

  const ALL_COLORS: HoldColor[] = ['red', 'green', 'blue', 'yellow', 'black', 'white', 'orange', 'purple', 'pink']

  const toggleColor = (color: HoldColor) => {
    const updated = value.includes(color)
      ? value.filter(c => c !== color)
      : [...value, color]
    onChange(updated)
  }

  return (
    <div className="space-y-3">
      <label className="text-xs font-mono text-[#666] uppercase tracking-wider">
        Enabled Hold Colors
      </label>
      <div className="grid grid-cols-3 gap-3" role="group" aria-label="Hold color selection">
        {ALL_COLORS.map((color) => {
          const isEnabled = value.includes(color)
          return (
            <button
              key={color}
              type="button"
              onClick={() => toggleColor(color)}
              className={`
                relative h-14 rounded-lg border-2 transition-all
                focus-visible:ring-2 focus-visible:ring-white focus-visible:ring-offset-2 focus-visible:ring-offset-[#09090b]
                ${isEnabled
                  ? 'border-white'
                  : 'border-white/10'
                }
              `}
              style={{
                backgroundColor: colorMap[color],
                opacity: isEnabled ? 1 : 0.3,
              }}
              aria-pressed={isEnabled}
              aria-label={`${isEnabled ? 'Disable' : 'Enable'} ${color} color`}
            >
              {isEnabled && (
                <svg className="absolute inset-0 m-auto h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={3} d="M5 13l4 4L19 7" />
                </svg>
              )}
            </button>
          )
        })}
      </div>
      <p className="text-xs text-[#666] mt-2">
        Tap colors to enable/disable them in your climb logger
      </p>
    </div>
  )
}
```

**Key implementation details:**
- Use inline styles for color hex values (more accurate than Tailwind classes)
- Grid: `grid-cols-3` on mobile (3 columns), can add `md:grid-cols-5` for larger screens
- Touch targets: `h-14` (56px) exceeds 44px minimum for mobile
- Disabled state: `opacity-0.3` for visual feedback
- Checkmark: Inline SVG for enabled state (3px stroke for visibility)
- Accessibility: `aria-pressed`, `aria-label`, `role="group"`, keyboard navigation
- Focus visible: Ring indicator for keyboard navigation
- Dark theme colors: Label uses `#666`, grid matches settings page background

**File location:** Create as `src/components/features/color-settings.tsx`

**Follow conventions:**
- PascalCase component name with kebab-case filename
- Functional component with props interface
- TypeScript strict typing
- Tailwind utility classes for styling
- Mobile-first responsive design</action>
  <verify>
    Run `pnpm typecheck` and verify:
    - No TypeScript errors
    - Component compiles without issues
    - Props interface is properly typed

    Run `pnpm lint` and verify:
    - No ESLint errors
    - Import ordering is correct
  </verify>
  <done>ColorSettings component created with 9-color grid, toggle functionality works, passes type checking and linting</done>
</task>

<task type="auto">
  <name>Task 2: Integrate ColorSettings into settings page</name>
  <files>src/components/features/settings-page.tsx</files>
  <action>Modify the existing settings-page.tsx to include the ColorSettings component and handle the new enabled_hold_colors field.

**Changes to settings-page.tsx:**

1. **Add import for ColorSettings component:**
```typescript
import { ColorSettings } from '@/components/features/color-settings'
import type { HoldColor } from '@/types'
```

2. **Update useForm defaultValues:**
Add `enabled_hold_colors` to defaultValues:
```typescript
const { handleSubmit, register, setValue, watch, reset } = useForm<UpdateProfileInput>({
  resolver: zodResolver(profileSchema),
  defaultValues: {
    preferred_grade_scale: profile?.preferred_grade_scale ?? 'font',
    preferred_discipline: profile?.preferred_discipline ?? 'boulder',
    home_gym: profile?.home_gym ?? '',
    enabled_hold_colors: profile?.enabled_hold_colors ?? ['red', 'green', 'blue', 'yellow', 'orange', 'purple', 'pink'],
  },
})
```

3. **Add watch for enabled_hold_colors:**
After the existing watch statements:
```typescript
const gradeScale = watch('preferred_grade_scale')
const discipline = watch('preferred_discipline')
const enabledColors = watch('enabled_hold_colors')
```

4. **Update useEffect to include enabled_hold_colors:**
Modify the reset call in useEffect:
```typescript
useEffect(() => {
  if (profile) {
    reset({
      preferred_grade_scale: profile.preferred_grade_scale,
      preferred_discipline: profile.preferred_discipline,
      home_gym: profile.home_gym ?? '',
      enabled_hold_colors: profile.enabled_hold_colors ?? ['red', 'green', 'blue', 'yellow', 'orange', 'purple', 'pink'],
    })
  }
}, [profile, reset])
```

5. **Add ColorSettings component to the form:**
Insert after the "Default Discipline" Select component, inside the bg-white/[0.02] div:
```tsx
<ColorSettings
  value={enabledColors ?? DEFAULT_COLORS}
  onChange={(colors) => setValue('enabled_hold_colors', colors)}
/>
```

6. **Define DEFAULT_COLORS constant at top of component (after imports):**
```typescript
const DEFAULT_COLORS: HoldColor[] = ['red', 'green', 'blue', 'yellow', 'orange', 'purple', 'pink']
```

**Placement:** Add the ColorSettings component as a new section in the settings form, between the "Default Discipline" field and the form buttons. This groups all preference settings together at the top.

**Styling:** The ColorSettings component should integrate seamlessly with the existing settings page design (same spacing, labels, dark theme colors).</action>
  <verify>
    Run `pnpm typecheck` and verify:
    - No TypeScript errors
    - enabled_hold_colors field is properly typed
    - ColorSettings component props match expected types

    Run `pnpm lint` and verify:
    - No ESLint errors
    - Import order is correct (ColorSettings import grouped with component imports)

    Manual verification:
    - Settings page loads without errors
    - Color grid renders with 9 colors
    - Clicking colors toggles enabled state
    - Checkmark appears/disappears correctly
  </verify>
  <done>Settings page includes ColorSettings component, form state manages enabled_hold_colors array, visual integration matches existing design</done>
</task>

<task type="auto">
  <name>Task 3: Test form persistence and validation</name>
  <files>src/components/features/settings-page.tsx, src/components/features/color-settings.tsx</files>
  <action>Test the complete color settings flow to ensure persistence and validation work correctly.

**Testing steps:**

1. **Form loading:**
   - Start dev server: `pnpm dev`
   - Navigate to settings page
   - Verify color grid loads with default colors (7 colors enabled, black/white disabled)
   - Check browser console for no errors

2. **Toggle functionality:**
   - Click a disabled color (e.g., black) - verify it becomes enabled with checkmark
   - Click an enabled color (e.g., red) - verify it becomes disabled (no checkmark, 30% opacity)
   - Verify visual feedback is immediate

3. **Form submission:**
   - Toggle several colors
   - Click "Save" button
   - Verify toast success message appears
   - Verify navigation back to home page

4. **Persistence:**
   - Navigate back to settings page
   - Verify your color selections are still enabled
   - Check Supabase database: `npx supabase db remote tables select profiles`
   - Verify enabled_hold_colors column stores your selections

5. **Validation:**
   - The form should always have at least 1 color enabled (user can disable all, but Zod schema allows empty array)
   - Verify the form accepts any combination of colors from the 9 available
   - Verify no invalid color values can be submitted

6. **Mobile responsiveness:**
   - Test on mobile viewport (375px width)
   - Verify grid shows 3 columns
   - Verify touch targets are easy to tap (56px height)
   - Verify no horizontal scroll

7. **Accessibility:**
   - Test keyboard navigation: Tab through color grid
   - Verify Enter/Space toggles color selection
   - Verify focus ring appears on focused color
   - Verify screen reader announces color name and state

**Do NOT commit test code** - this is manual verification only.</action>
  <verify>
    Manual testing checklist:
    - [ ] Settings page loads with ColorSettings component
    - [ ] Default colors are enabled on first load
    - [ ] Clicking colors toggles enabled state correctly
    - [ ] Save button persists changes to Supabase
    - [ ] Reloading settings shows persisted colors
    - [ ] Mobile layout works correctly (3 columns, 56px touch targets)
    - [ ] Keyboard navigation works (Tab, Enter, Space)
    - [ ] No console errors during testing

    Run `pnpm typecheck` and `pnpm lint` to verify no regressions.
  </verify>
  <done>Complete color settings flow tested: form loading, toggle functionality, save persistence, mobile responsiveness, and accessibility all working correctly</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] ColorSettings component created at src/components/features/color-settings.tsx
- [ ] Component renders 9-color grid with proper styling
- [ ] Settings page integrates ColorSettings component
- [ ] Form state manages enabled_hold_colors array
- [ ] Save functionality persists to Supabase profiles table
- [ ] Settings page reload shows persisted color selections
- [ ] Mobile responsive (3 columns, 56px touch targets)
- [ ] Keyboard accessible (Tab, Enter, Space, focus rings)
- [ ] `pnpm typecheck` passes with no errors
- [ ] `pnpm lint` passes with no errors
- [ ] No console errors during manual testing
</verification>

<success_criteria>

- ColorSettings component displays 9-color grid (3x3 on mobile)
- Toggle functionality works correctly (click to enable/disable)
- Visual feedback: Checkmark for enabled, 30% opacity for disabled
- Form persistence: enabled_hold_colors saves to Supabase on form submit
- Form loading: Persisted colors load correctly on settings page
- Mobile-friendly: 56px touch targets, 3-column grid, no horizontal scroll
- Accessible: Keyboard navigation, aria-pressed, aria-label, focus rings
- Integration: Matches existing settings page design and patterns
- No TypeScript or linting errors
  </success_criteria>

<output>
After completion, create `.planning/phases/02-settings-page/02-02-SUMMARY.md`
</output>
