---
phase: 19-coach-page-recommendations-ui
plan: 04
type: execute
wave: 3
depends_on: [19-03]
files_modified:
  - src/components/features/coach-page.tsx
autonomous: true
must_haves:
  truths:
    - Error state displays centered with error message for recommendations
    - Error state displays centered with error message for patterns
    - Loading state shows while regenerating recommendations
    - Loading state shows while extracting patterns
    - Empty state shows when no recommendations exist
    - Empty state shows when no climbing data exists for patterns
  artifacts:
    - path: src/components/features/coach-page.tsx
      provides: Complete error and loading state handling
      contains: "if (error)", "if (isLoading)", "patternsLoading", "toast.error"
  key_links:
    - from: "useCoachRecommendations error"
      to: "error state UI"
      via: "conditional render"
      pattern: "if \\(error\\)"
    - from: "usePatternAnalysis error"
      to: "patterns loading/error UI"
      via: "conditional render in TabsContent"
      pattern: "if \\(patternsLoading\\)"
    - from: "generateRecommendations.mutate"
      to: "toast.success/toast.error"
      via: "onSuccess/onError callbacks"
      pattern: "toast\\.(success|error)"
---

<objective>
Implement complete loading states and error handling for Coach Page
Purpose: Ensure all edge cases are handled with clear UI feedback for loading, errors, and empty states
Output: Robust UI with no crashes, clear error messages, and loading indicators
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/19-coach-page-recommendations-ui/19-RESEARCH.md
@.planning/phases/19-coach-page-recommendations-ui/19-03-SUMMARY.md

@src/components/features/coach-page.tsx
@src/components/features/charts-page.tsx
</context>

<tasks>

<task type="auto">
  <name>Verify and enhance loading states</name>
<files>src/components/features/coach-page.tsx</files>
<action>
Review and verify all loading states in CoachPage are complete:

1. Verify recommendations loading state:
   if (isLoading) {
     return (
       <div className="min-h-screen bg-[#0a0a0a] text-[#f5f5f5] p-4 pb-24">
         <div className="mx-auto max-w-2xl">
           <div className="text-center py-12 text-[#888]">Loading recommendations...</div>
         </div>
       </div>
     )
   }

2. Verify pattern analysis loading state (in Patterns TabsContent):
   {patternsLoading ? (
     <div className="text-center py-12 text-[#888]">Loading patterns...</div>
   ) : ...

3. Verify regenerate button loading state:
   <Button
     disabled={generateRecommendations.isPending}
     ...
   >
     {generateRecommendations.isPending ? 'Generating...' : 'Regenerate Recommendations'}
   </Button>

4. Verify error handling in handleRegenerate:
   onError: (err) => toast.error(`Failed to regenerate: ${err.message}`)

5. If any loading states are missing or inconsistent, add them following the ChartsPage pattern.

The existing code from plan 19-03 should have most of this - verify it's complete and consistent.
  </action>
  <verify>
pnpm typecheck passes
</verify>
  <done>
All loading states verified and complete (recommendations loading, patterns loading, regenerate button)
</done>
</task>

<task type="auto">
  <name>Verify and enhance error states</name>
<files>src/components/features/coach-page.tsx</files>
<action>
Review and verify all error states in CoachPage are complete:

1. Verify recommendations error state:
   if (error) {
     return (
       <div className="min-h-screen bg-[#0a0a0a] text-[#f5f5f5] p-4 pb-24">
         <div className="mx-auto max-w-2xl">
           <div className="text-center py-12 text-red-400">
             Failed to load recommendations: {error.message}
           </div>
         </div>
       </div>
     )
   }

2. If pattern analysis has an error (optional enhancement):
   Add error state for patterns if patternsError exists:
   {patternsError ? (
     <div className="text-center py-12 text-red-400">
       Failed to load patterns: {patternsError.message}
     </div>
   ) : patterns ? (...) : (...)}

3. Verify error handling in handleRegenerate is complete:
   onError: (err) => toast.error(`Failed to regenerate: ${err.message}`)

4. If any error states are missing, add them following the ChartsPage pattern for consistency.

Note: The error state for patterns is optional since getEmptyPatterns() is called when no climbs exist, but it's good defensive programming.
  </action>
  <verify>
pnpm typecheck passes
</verify>
  <done>
All error states verified and complete (recommendations error, regenerate error, optional patterns error)
</done>
</task>

<task type="auto">
  <name>Verify empty states</name>
<files>src/components/features/coach-page.tsx</files>
<action>
Review and verify all empty states in CoachPage are complete:

1. Verify no recommendations empty state (should already exist):
   if (!recommendations) {
     return (
       <div className="min-h-screen bg-[#0a0a0a] text-[#f5f5f5] p-4 pb-24">
         <div className="mx-auto max-w-2xl">
           <header className="border-b-2 border-white/20 pb-6">
             <h1 className="text-5xl font-black tracking-tighter uppercase mb-2">Coach</h1>
             <p className="text-sm font-mono text-[#888] uppercase tracking-widest">
               AI-powered training recommendations
             </p>
           </header>
           <div className="text-center py-16">
             <p className="text-[#888] mb-6">No recommendations yet</p>
             <Button onClick={() => void handleRegenerate()} ...>
               Generate Recommendations
             </Button>
           </div>
         </div>
       </div>
     )
   }

2. Verify no climbing data empty state (in Patterns TabsContent):
   ) : (
     <div className="text-center py-12 text-[#888]">
       No climbing data available for pattern analysis
     </div>
   )}

3. Verify empty drill list handling:
   If content.drills is empty, show a message:
   {content.drills.length === 0 ? (
     <FormSection>
       <p className="text-center text-[#888]">No drills available</p>
     </FormSection>
   ) : (
     content.drills.map(...)
   )}

4. Verify empty failure patterns handling:
   If patterns.failure_patterns.most_common_failure_reasons is empty, show:
   {patterns.failure_patterns.most_common_failure_reasons.length === 0 ? (
     <p className="text-center text-[#888]">No failure data yet</p>
   ) : (
     patterns.failure_patterns.most_common_failure_reasons.map(...)
   )}

Add these empty state checks if missing for better user experience.
  </action>
  <verify>
pnpm typecheck passes
</verify>
  <done>
All empty states verified and complete (no recommendations, no climbs, no drills, no failure patterns)
</done>
</task>

</tasks>

<verification>
After completion, verify:
1. TypeScript compiles without errors
2. All loading states exist and render correctly
3. All error states exist and show clear error messages
4. All empty states exist with helpful messaging
5. Toast notifications show on regenerate success/error
6. No crashes when data is missing or empty
</verification>

<success_criteria>
Coach Page has complete error handling and loading states for all data sources (recommendations, patterns, regenerate)
</success_criteria>

<output>
After completion, create `.planning/phases/19-coach-page-recommendations-ui/19-04-SUMMARY.md`
</output>
