---
phase: 19-coach-page-recommendations-ui
plan: 03
type: execute
wave: 2
depends_on: [19-02]
files_modified:
  - src/components/features/coach-page.tsx
  - src/components/features/pattern-analysis.tsx
autonomous: true
must_haves:
  truths:
    - Weekly focus statement displays clearly in FormSection
    - Three drills show with name, description, sets, reps, and rest
    - Failure patterns show top 5 reasons with count and percentage
    - Style weaknesses show top 5 styles with fail rate
    - Climbing frequency shows average per session and per month
    - Recent successes show redemption count and grade progression
    - Empty state displays when no climbing data exists
    - Tabs switch between Recommendations and Pattern Analysis
  artifacts:
    - path: src/components/features/coach-page.tsx
      provides: Full coach page with recommendations display
      contains: "weekly_focus", "drills.map", "TabsContent"
    - path: src/components/features/pattern-analysis.tsx
      provides: Pattern analysis display component
      contains: "PatternAnalysis", "failure_patterns", "style_weaknesses"
  key_links:
    - from: "RecommendationsDisplay"
      to: "recommendations.content"
      via: "type assertion"
      pattern: "content as \\{ weekly_focus, drills \\}"
    - from: "PatternAnalysis component"
      to: "usePatternAnalysis"
      via: "import and hook call"
      pattern: "usePatternAnalysis\\(\\)"
    - from: "Badge components"
      to: "failure_patterns.most_common_failure_reasons"
      via: "map over array"
      pattern: "\\.map\\(\\(item\\) =>"
---

<objective>
Implement recommendations display and pattern analysis UI components
Purpose: Show weekly focus, 3 drills, pattern analysis sections with failure patterns, style weaknesses, frequency, and successes
Output: Complete recommendations tab with drill cards and patterns tab with all analysis sections
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/19-coach-page-recommendations-ui/19-RESEARCH.md
@.planning/phases/19-coach-page-recommendations-ui/19-02-SUMMARY.md

@src/components/features/charts-page.tsx
@src/components/features/climb-card.tsx
@src/components/features/coach-page.tsx
@src/hooks/useCoach.ts
@src/services/patterns.ts
@src/types/index.ts
@src/components/ui/form-section.tsx
@src/components/ui/badge.tsx
</context>

<tasks>

<task type="auto">
  <name>Create RecommendationsDisplay component</name>
  <files>src/components/features/coach-page.tsx</files>
  <action>
Update the Recommendations tab content in CoachPage with full recommendations display:

1. Type assert recommendations.content:
   const content = recommendations.content as {
     weekly_focus: string
     drills: Array<{
       name: string
       description: string
       sets: number
       reps: string
       rest: string
     }>
   }

2. Import useNavigate from react-router-dom, MessageCircle and RefreshCw icons from lucide-react, formatDistanceToNow from date-fns

3. Create handleRegenerate function:
   const handleRegenerate = () => {
     generateRecommendations.mutate(
       {
         climbs: climbs || [],
         user_preferences: {
           preferred_discipline: 'boulder',
           preferred_grade_scale: 'font',
         },
       },
       {
         onSuccess: () => toast.success('Recommendations regenerated successfully'),
         onError: (err) => toast.error(`Failed to regenerate: ${err.message}`),
       }
     )
   }

4. Replace placeholder Recommendations TabsContent with:

   <TabsContent value="recommendations" className="mt-6 space-y-8">
     {/* Weekly Focus Section */}
     <section>
       <div className="flex items-center gap-4 mb-6">
         <div className="h-1 flex-1 bg-blue-500" />
         <h2 className="text-3xl font-black tracking-tighter uppercase">Weekly Focus</h2>
         <div className="h-1 flex-1 bg-blue-500" />
       </div>
       <FormSection>
         <FormLabel className="mb-4 block">This week's focus</FormLabel>
         <p className="text-lg text-[#f5f5f5] leading-relaxed">{content.weekly_focus}</p>
       </FormSection>
     </section>

     {/* Drills Section */}
     <section>
       <div className="flex items-center gap-4 mb-6">
         <div className="h-1 flex-1 bg-green-500" />
         <h2 className="text-3xl font-black tracking-tighter uppercase">Training Drills</h2>
         <div className="h-1 flex-1 bg-green-500" />
       </div>

       {content.drills.map((drill, index) => (
         <FormSection key={index} className="mb-4">
           <div className="flex items-start justify-between mb-3">
             <h3 className="text-xl font-black uppercase">{drill.name}</h3>
             <Badge variant="outline" className="text-xs font-mono border-white/20 text-[#ccc]">
               {drill.sets} Ã— {drill.reps}
             </Badge>
           </div>
           <p className="text-sm text-[#bbb] leading-relaxed mb-3">{drill.description}</p>
           <div className="flex items-center gap-2 text-xs font-mono text-[#666]">
             <span>Rest: {drill.rest}</span>
           </div>
         </FormSection>
       ))}
     </section>

     {/* Action Buttons */}
     <div className="flex flex-col gap-3">
       <Button
         onClick={() => void handleRegenerate()}
         disabled={generateRecommendations.isPending}
         className="w-full h-12 bg-white text-black hover:bg-white/90 font-black uppercase tracking-wider disabled:opacity-50"
       >
         <RefreshCw className="h-4 w-4 mr-2" />
         {generateRecommendations.isPending ? 'Generating...' : 'Regenerate Recommendations'}
       </Button>
       <Button
         variant="outline"
         onClick={() => navigate('/coach/chat')}
         className="w-full h-12 border-white/20 hover:border-white/40 bg-white/[0.02] text-white font-black uppercase tracking-wider"
       >
         <MessageCircle className="h-4 w-4 mr-2" />
         Ask Coach a Question
       </Button>
     </div>

     {/* Last Updated */}
     <div className="text-center pt-4">
       <FormLabel>
         Last updated: {formatDistanceToNow(new Date(recommendations.generation_date), { addSuffix: true })}
       </FormLabel>
     </div>
   </TabsContent>

Import Badge from '@/components/ui/badge' for the drill sets/reps display.

Follow the exact section header pattern from ChartsPage (colored lines on both sides).
  </action>
  <verify>
pnpm typecheck passes
</verify>
  <done>
Recommendations tab displays weekly focus, 3 drills, regenerate button, "Ask Coach" button, and last updated date
</done>
</task>

<task type="auto">
  <name>Create PatternAnalysis component</name>
  <files>src/components/features/coach-page.tsx</files>
  <action>
Replace the placeholder Pattern Analysis TabsContent with full pattern analysis display:

1. Import usePatternAnalysis from '@/hooks/useCoach'

2. Inside CoachPage, call usePatternAnalysis:
   const { data: patterns, isLoading: patternsLoading, error: patternsError } = usePatternAnalysis()

3. Replace Pattern Analysis TabsContent with:

   <TabsContent value="patterns" className="mt-6 space-y-8">
     {patternsLoading ? (
       <div className="text-center py-12 text-[#888]">Loading patterns...</div>
     ) : patterns ? (
       <>
         {/* Failure Patterns */}
         <section>
           <div className="flex items-center gap-4 mb-6">
             <div className="h-1 flex-1 bg-orange-500" />
             <h2 className="text-3xl font-black tracking-tighter uppercase">Failure Patterns</h2>
             <div className="h-1 flex-1 bg-orange-500" />
           </div>
           <FormSection>
             <div className="space-y-3">
               {patterns.failure_patterns.most_common_failure_reasons.map((item) => (
                 <div key={item.reason} className="flex items-center justify-between">
                   <Badge variant="outline" className="text-xs font-mono border-white/20 text-[#ccc]">
                     {item.reason}
                   </Badge>
                   <span className="text-sm text-[#888]">
                     {item.count} times ({item.percentage}%)
                   </span>
                 </div>
               ))}
             </div>
           </FormSection>
         </section>

         {/* Style Weaknesses */}
         <section>
           <div className="flex items-center gap-4 mb-6">
             <div className="h-1 flex-1 bg-rose-500" />
             <h2 className="text-3xl font-black tracking-tighter uppercase">Style Weaknesses</h2>
             <div className="h-1 flex-1 bg-rose-500" />
           </div>
           <FormSection>
             <div className="space-y-3">
               {patterns.style_weaknesses.struggling_styles.map((item) => (
                 <div key={item.style} className="flex items-center justify-between">
                   <Badge variant="outline" className="text-xs font-mono border-white/20 text-[#ccc]">
                     {item.style}
                   </Badge>
                   <span className="text-sm text-[#888]">
                     {Math.round(item.fail_rate * 100)}% fail rate ({item.fail_count}/{item.total_attempts})
                   </span>
                 </div>
               ))}
             </div>
           </FormSection>
         </section>

         {/* Climbing Frequency */}
         <section>
           <div className="flex items-center gap-4 mb-6">
             <div className="h-1 flex-1 bg-teal-500" />
             <h2 className="text-3xl font-black tracking-tighter uppercase">Climbing Frequency</h2>
             <div className="h-1 flex-1 bg-teal-500" />
           </div>
           <FormSection>
             <div className="space-y-4">
               <div className="text-center">
                 <p className="text-sm text-[#888] mb-1">Average per session</p>
                 <p className="text-4xl font-black">{patterns.climbing_frequency.avg_climbs_per_session}</p>
               </div>
               <div className="text-center pt-4 border-t border-white/10">
                 <p className="text-sm text-[#888] mb-1">Per month</p>
                 <p className="text-4xl font-black">{patterns.climbing_frequency.climbs_per_month}</p>
               </div>
             </div>
           </FormSection>
         </section>

         {/* Recent Successes */}
         <section>
           <div className="flex items-center gap-4 mb-6">
             <div className="h-1 flex-1 bg-purple-500" />
             <h2 className="text-3xl font-black tracking-tighter uppercase">Recent Successes</h2>
             <div className="h-1 flex-1 bg-purple-500" />
           </div>
           <FormSection>
             <div className="space-y-4">
               <div className="text-center">
                 <p className="text-sm text-[#888] mb-1">Redemptions</p>
                 <p className="text-4xl font-black">{patterns.recent_successes.redemption_count}</p>
               </div>
               {patterns.recent_successes.grade_progression.length > 0 && (
                 <div className="pt-4 border-t border-white/10">
                   <p className="text-sm text-[#888] mb-3 text-center">Grade Progression</p>
                   <div className="space-y-2">
                     {patterns.recent_successes.grade_progression.map((gp, i) => (
                       <div key={i} className="flex justify-between text-sm">
                         <span className="text-[#888]">{gp.date}</span>
                         <span className="font-mono">{gp.grade}</span>
                       </div>
                     ))}
                   </div>
                 </div>
               )}
             </div>
           </FormSection>
         </section>
       </>
     ) : (
       <div className="text-center py-12 text-[#888]">
         No climbing data available for pattern analysis
       </div>
     )}
   </TabsContent>

Import Badge from '@/components/ui/badge' for the failure reason and style badges.

Follow the exact section header pattern from ChartsPage (colored lines on both sides).
  </action>
  <verify>
pnpm typecheck passes
</verify>
  <done>
Pattern Analysis tab displays failure patterns, style weaknesses, climbing frequency, and recent successes with loading and empty states
</done>
</task>

</tasks>

<verification>
After completion, verify:
1. TypeScript compiles without errors
2. Weekly focus and drills display correctly in Recommendations tab
3. Pattern Analysis tab shows all 4 sections (failures, styles, frequency, successes)
4. Tabs switch between views correctly
5. Styling matches ChartsPage pattern (colored divider lines, FormSection wrappers)
6. Badge components render for failure reasons and styles
</verification>

<success_criteria>
CoachPage has complete UI for recommendations (focus + drills) and pattern analysis (all sections) with proper loading/empty states
</success_criteria>

<output>
After completion, create `.planning/phases/19-coach-page-recommendations-ui/19-03-SUMMARY.md`
</output>
