---
phase: 19-coach-page-recommendations-ui
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/hooks/useCoach.ts
  - src/components/features/index.ts
autonomous: true
must_haves:
  truths:
    - Pattern analysis data loads when Pattern Analysis tab is active
    - Loading state shows while extracting patterns
    - Error displays if pattern extraction fails
    - Empty state shows when no climbs exist
    - Data is cached for 24 hours to avoid redundant calculations
  artifacts:
    - path: src/hooks/useCoach.ts
      provides: usePatternAnalysis hook
      exports: ["usePatternAnalysis"]
    - path: src/components/features/index.ts
      provides: Re-export of CoachPage component
      exports: ["CoachPage"]
  key_links:
    - from: "usePatternAnalysis"
      to: "extractPatterns"
      via: "direct function call"
      pattern: "extractPatterns\\(userId\\)"
    - from: "usePatternAnalysis"
      to: "TanStack Query cache"
      via: "staleTime: 24h"
      pattern: "staleTime: 24 \\* 60 \\* 60 \\* 1000"
---

<objective>
Create usePatternAnalysis hook for loading pattern analysis data
Purpose: Provide a TanStack Query hook that fetches pattern analysis from extractPatterns service with caching and loading states
Output: Working hook that returns { data, isLoading, error } with 24h cache
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/19-coach-page-recommendations-ui/19-RESEARCH.md

@src/hooks/useCoach.ts
@src/hooks/useClimbs.ts
@src/services/patterns.ts
@src/types/index.ts
</context>

<tasks>

<task type="auto">
  <name>Create usePatternAnalysis hook</name>
  <files>src/hooks/useCoach.ts</files>
  <action>
Add usePatternAnalysis hook to src/hooks/useCoach.ts following the pattern of useCoachRecommendations:

1. Import useQuery from '@tanstack/react-query'
2. Import supabase from '@/lib/supabase'
3. Import extractPatterns from '@/services/patterns'

4. Create export function usePatternAnalysis() that:
   - Calls useQuery with:
     * queryKey: ['coach', 'patterns'] (or use a keys pattern like coachKeys.patterns())
     * queryFn: async () => get authenticated user, then call extractPatterns(user.id)
     * staleTime: 24 * 60 * 60 * 1000 (24 hours - same as recommendations)
     * gcTime: 7 * 24 * 60 * 60 * 1000 (7 days cache)
   - Returns the useQuery result (data, isLoading, error, etc.)

5. Ensure error handling:
   - Throw error if supabase not configured
   - Throw error if not authenticated

6. Add to patternKeys object if you want to follow the coachKeys pattern:
   Add patterns: () => [...coachKeys.all, 'patterns'] as const

Reference: useCoachRecommendations() hook in the same file for the exact pattern to follow.

The extractPatterns function already returns PatternAnalysis interface with:
- failure_patterns: { most_common_failure_reasons: [] }
- style_weaknesses: { struggling_styles: [] }
- climbing_frequency: { climbs_per_week: [], climbs_per_month: 0, avg_climbs_per_session: 0 }
- recent_successes: { recent_sends: [], grade_progression: [], redemption_count: 0 }
  </action>
  <verify>
pnpm typecheck passes (no TypeScript errors in useCoach.ts)
</verify>
  <done>
usePatternAnalysis hook exists in src/hooks/useCoach.ts, returns { data, isLoading, error } with 24h staleTime, authenticated user check
</done>
</task>

</tasks>

<verification>
After completion, verify:
1. TypeScript compiles without errors
2. Hook matches the pattern of useCoachRecommendations
3. Cache duration is 24 hours (staleTime)
4. Extract patterns with authenticated user
</verification>

<success_criteria>
usePatternAnalysis hook works and can be imported to load pattern analysis data for the Coach Page
</success_criteria>

<output>
After completion, create `.planning/phases/19-coach-page-recommendations-ui/19-01-SUMMARY.md`
</output>
