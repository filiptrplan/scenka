---
phase: 05.1-logger-window-close-setting
plan: 02
type: execute
wave: 1
depends_on: []
files_modified: [src/components/features/settings-page.tsx, src/components/features/logger.tsx, src/App.tsx]
autonomous: true
---

<objective>
Add settings UI for logger close preference and implement the behavior in Logger component.

Purpose: Allow users to choose between keeping logger open for batch entry vs. auto-closing after each climb.
Output: Settings UI component, Logger integration respecting preference, App wiring
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-logger-form-reset/05-01-SUMMARY.md

# Logger already controlled via open prop from App.tsx
# Settings page already handles user preferences with react-hook-form

@src/components/features/settings-page.tsx
@src/components/features/logger.tsx
@src/App.tsx
@src/types/index.ts
@src/lib/validation.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add logger close preference UI to settings page</name>
  <files>src/components/features/settings-page.tsx</files>
  <action>
    1. Add new section in settings page form after existing settings (home_gym, grade_scale, etc.)
    2. Use Select component (same pattern as grade_scale, discipline) for two options: 'keep_open' (Keep Open) and 'auto_close' (Auto Close)
    3. Label: "Logger Behavior After Adding Climb" or similar clear label
    4. Register field with react-hook-form: setValue('logger_close_behavior', value)
    5. Watch value: const loggerBehavior = watch('logger_close_behavior')
    6. Include in reset() and defaultValues
    7. Follow existing settings page patterns for consistency (layout, styling, z.input type usage)
  </action>
  <verify>Settings page compiles and shows new dropdown option</verify>
  <done>Settings UI has logger_close_behavior dropdown with two options, wired to form state</done>
</task>

<task type="auto">
  <name>Task 2: Update Logger and App to respect close behavior preference</name>
  <files>src/components/features/logger.tsx, src/App.tsx</files>
  <action>
    In App.tsx:
    1. Import logger_close_behavior from profile (it's in Profile type from Phase 05.1-01)
    2. Pass loggerCloseBehavior prop to Logger component (new prop, optional string: 'keep_open' | 'auto_close' | undefined)

    In Logger.tsx:
    1. Add loggerCloseBehavior?: 'keep_open' | 'auto_close' to LoggerProps interface
    2. In handleClimbSubmit (after onSubmit call), check: if (loggerCloseBehavior === 'auto_close' && climb === null) { onOpenChange?.(false) }
    3. Keep current behavior for 'keep_open' and undefined (sheet stays open, form resets)
    4. Preserve edit behavior: if climb !== null (editing), always close sheet regardless of preference
    5. Add comment explaining logic: "Only auto-close for new climbs when preference is 'auto_close'"
  </action>
  <verify>pnpm typecheck passes, Logger accepts new prop, App passes profile value</verify>
  <done>Logger accepts loggerCloseBehavior prop, auto-closes sheet when preference is 'auto_close' and adding new climb</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Settings page shows logger close behavior dropdown
- [ ] pnpm typecheck passes with no errors
- [ ] Logger accepts loggerCloseBehavior prop
- [ ] App passes profile.logger_close_behavior to Logger
- [ ] Logger auto-closes when preference is 'auto_close' and adding new climb
- [ ] Logger stays open when preference is 'keep_open' (current behavior)
- [ ] Edit climb still closes sheet (existing behavior preserved)
</verification>

<success_criteria>

- Settings UI has logger close behavior dropdown
- Logger respects preference for new climbs
- Edit climb behavior unchanged (closes sheet)
- Type safety maintained
</success_criteria>

<output>
After completion, create `.planning/phases/05.1-logger-window-close-setting/05.1-02-SUMMARY.md`
</output>
