---
phase: 05.1-logger-window-close-setting
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [supabase/migrations/*.sql, src/types/index.ts, src/lib/validation.ts]
autonomous: true
---

<objective>
Add database column and TypeScript types for logger close behavior preference.

Purpose: Enable user to control whether the logger sheet stays open or closes after adding climbs, improving efficiency for batch logging.
Output: Database migration, updated TypeScript Profile interface, Zod schema with logger_close_behavior field
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-logger-form-reset/05-01-SUMMARY.md

# User preferences already exist in profiles table
# Follow established patterns from enabled_hold_colors (Phase 02-01)

@src/types/index.ts
@src/lib/validation.ts
@src/services/profiles.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create database migration for logger_close_behavior column</name>
  <files>supabase/migrations/20260115XXXXXX_add_logger_close_behavior.sql</files>
  <action>Create migration file adding TEXT column logger_close_behavior to profiles table. Use TEXT type (not TEXT[]) since this is a single preference value. Set DEFAULT 'keep_open' to maintain current behavior (sheet stays open after form reset). Follow migration naming pattern: YYYYMMDDHHMMSS_description.sql. Reference existing migration pattern from Phase 02-01 (20260115161724_add_enabled_hold_colors.sql) for Postgres array defaults, but use simple DEFAULT for single text value.</action>
  <verify>Migration file exists in supabase/migrations/ with proper SQL syntax</verify>
  <done>Migration file created with DEFAULT 'keep_open' for new users</done>
</task>

<task type="auto">
  <name>Task 2: Update TypeScript types and Zod schema for logger_close_behavior</name>
  <files>src/types/index.ts, src/lib/validation.ts</files>
  <action>
    1. In src/types/index.ts: Add logger_close_behavior: 'keep_open' | 'auto_close' field to Profile interface (Row, Insert, Update). Use literal union type for type safety.
    2. In src/lib/validation.ts: Add logger_close_behavior field to profileSchema with z.enum(['keep_open', 'auto_close']). Set default to 'keep_open' using .default() to match database default.
    3. Verify Profile interface export includes the new field in all variants (Row, Insert, Update).
    4. Follow pattern from enabled_hold_colors field (Phase 02-01) for zod default handling.
  </action>
  <verify>Run pnpm typecheck - no TypeScript errors for Profile type usage</verify>
  <done>Profile interface includes logger_close_behavior, profileSchema validates enum values with default</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Migration file exists and has valid SQL syntax
- [ ] pnpm typecheck passes with no errors
- [ ] Profile type includes logger_close_behavior in Row/Insert/Update
- [ ] profileSchema validates enum values ('keep_open', 'auto_close')
</verification>

<success_criteria>

- Migration file created with DEFAULT 'keep_open'
- TypeScript Profile interface updated with logger_close_behavior field
- Zod schema validates enum values with default
- Type checking passes
</success_criteria>

<output>
After completion, create `.planning/phases/05.1-logger-window-close-setting/05.1-01-SUMMARY.md`
</output>
