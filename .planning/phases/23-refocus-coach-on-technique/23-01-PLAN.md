---
phase: 23-refocus-coach-on-technique
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [src/types/index.ts, src/lib/coachUtils.ts]
autonomous: true

must_haves:
  truths:
    - "AnonymizedClimb type includes notes and date fields for LLM context"
    - "anonymizeClimbsForAI() includes sanitized notes and formatted dates"
    - "validateAnonymizedData() checks notes field for PII"
  artifacts:
    - path: "src/types/index.ts"
      provides: "Type definition with notes and date"
      contains: "export interface AnonymizedClimb"
    - path: "src/lib/coachUtils.ts"
      provides: "Updated anonymization logic"
      contains: "export function anonymizeClimbsForAI"
  key_links:
    - from: "src/lib/coachUtils.ts"
      to: "src/types/index.ts"
      via: "AnonymizedClimb type"
      pattern: "import.*AnonymizedClimb"
---

<objective>
Add notes and date fields to AnonymizedClimb type and update anonymization logic to include these fields for LLM context.

Purpose: The LLM needs access to user notes and climb dates to provide more personalized and time-aware technique recommendations.

Output: Updated type definition and anonymization function that includes sanitized notes and formatted dates.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/23-refocus-coach-on-technique/23-CONTEXT.md
@.planning/phases/23-refocus-coach-on-technique/23-RESEARCH.md

@src/types/index.ts
@src/lib/coachUtils.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update AnonymizedClimb type</name>
  <files>src/types/index.ts</files>
  <action>
Update the AnonymizedClimb interface to include notes and date fields:

1. Add `notes?: string | null` field to allow optional notes
2. Add `date: string` field for climb date (ISO 8601 format)
3. The `notes` field should be optional since climbs may not have notes
4. The `date` field is required (always has a created_at date)

Do NOT modify any other type definitions.
</action>
  <verify>grep -A 8 "export interface AnonymizedClimb" src/types/index.ts shows notes and date fields</verify>
  <done>AnonymizedClimb type includes notes and date fields with correct types</done>
</task>

<task type="auto">
  <name>Task 2: Update anonymizeClimbsForAI to include notes and date</name>
  <files>src/lib/coachUtils.ts</files>
  <action>
Update the anonymizeClimbsForAI function to include notes and date:

1. Add `notes: climb.notes || null` to the mapped object - this preserves the optional nature
2. Add `date: new Date(climb.created_at).toISOString().split('T')[0]` - use YYYY-MM-DD format for readability
3. The notes field should be included as-is (Phase 23 CONTEXT says to include notes)
4. The date field should use created_at, formatted as YYYY-MM-DD

Reference the existing climb object structure from src/types/index.ts:
- climb.notes is `string | null`
- climb.created_at is `string` (ISO 8601)

Do NOT modify sanitizeLocation or validateAnonymizedData functions.
</action>
  <verify>
grep -A 10 "return climbs.map" src/lib/coachUtils.ts | grep -E "(notes|date):"
</verify>
  <done>anonymizeClimbsForAI returns AnonymizedClimb[] with notes and date fields populated</done>
</task>

<task type="auto">
  <name>Task 3: Update validateAnonymizedData to check notes field</name>
  <files>src/lib/coachUtils.ts</files>
  <action>
Update the validateAnonymizedData function to check the notes field for PII:

1. In the checkForPII function, after the "Long name-like field" check
2. Add a new check: if key.toLowerCase().includes('notes') and value.length > 200, add to piiFields
3. This catches unusually long notes that might contain PII (names, emails, phone numbers)
4. The 200 character threshold is reasonable for climbing notes without blocking normal use

The check should follow this pattern:
```typescript
// Unusually long notes might contain PII
if (key.toLowerCase().includes('notes') && value.length > 200) {
  piiFields.push(currentPath)
}
```

Do NOT modify any other validation logic.
</action>
  <verify>grep "notes" src/lib/coachUtils.ts | grep -v "// " | grep -v "climb.notes"</verify>
  <done>validateAnonymizedData checks notes field for excessive length (>200 chars)</done>
</task>

</tasks>

<verification>
- [ ] Type definitions include notes and date fields
- [ ] Anonymization function maps notes and date correctly
- [ ] Validation function checks notes field for PII indicators
- [ ] No other type definitions were modified
- [ ] TypeScript compiles without errors (pnpm typecheck)
</verification>

<success_criteria>
AnonymizedClimb type includes notes and date fields; anonymizeClimbsForAI populates these fields; validateAnonymizedData checks notes for PII.
</success_criteria>

<output>
After completion, create `.planning/phases/23-refocus-coach-on-technique/23-01-SUMMARY.md`
</output>
