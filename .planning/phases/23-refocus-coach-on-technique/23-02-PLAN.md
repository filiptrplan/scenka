---
phase: 23-refocus-coach-on-technique
plan: 02
type: execute
wave: 1
depends_on: []
files_modified: [supabase/functions/openrouter-coach/index.ts]
autonomous: true

must_haves:
  truths:
    - "System prompt emphasizes technique over strength training"
    - "Strength failures are reframed as technique gaps"
    - "Drill schema includes measurable_outcome field"
  artifacts:
    - path: "supabase/functions/openrouter-coach/index.ts"
      provides: "Technique-focused system prompt and drill validation"
      contains: "const systemPrompt ="
      contains: "measurable_outcome"
  key_links:
    - from: "systemPrompt"
      to: "validateResponse"
      via: "Drill schema validation"
      pattern: "drill\\.measurable_outcome"
---

<objective>
Update the Edge Function system prompt to focus on technique and add measurable_outcome field to drill schema.

Purpose: Reframe the coach from strength training to technique-focused coaching, and ensure all drills have measurable outcomes for user progress tracking.

Output: Modified system prompt with technique emphasis and updated drill validation including measurable_outcome field.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/23-refocus-coach-on-technique/23-CONTEXT.md
@.planning/phases/23-refocus-coach-on-technique/23-RESEARCH.md

@supabase/functions/openrouter-coach/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update system prompt to focus on technique</name>
  <files>supabase/functions/openrouter-coach/index.ts</files>
  <action>
Update the systemPrompt constant to focus exclusively on technique:

1. Replace the introduction with:
   - "You are an expert climbing coach specializing in bouldering and sport climbing technique. Your core philosophy: most 'strength' failures are actually technique gaps."
   - Add explicit reframing guidance: "When users fail due to 'Pumped', 'Finger Strength', 'Core', or 'Power', reframe these as technique issues."

2. Update the drill terminology section from strength-focused to technique-focused:
   - Remove: "Hangboard protocols", "Campus board", "Antagonistic training", "Periodization"
   - Add: "Movement drills (silent feet, straight arms, body tension)", "Positioning drills (flagging, drop-knees, back-steps)", "Efficiency drills (rest positions, clipping sequence)", "Footwork drills (precision, smear usage, heel/toe hooks)", "Body positioning drills (center of gravity, hip turns, momentum)"

3. Add strength→technique reframing examples:
   - "Pumped: explain efficient movement and resting technique to conserve energy"
   - "Finger Strength: explain crimping technique with proper body position to reduce load"
   - "Core: explain body tension drills to improve center of gravity control"
   - "Power: explain momentum and body positioning drills for dynamic movement"

4. Keep the existing JSON structure requirements but update the example to be technique-focused

5. Add emphasis on measurable outcomes: "Each drill must have a measurable outcome (e.g., 'Complete 10 routes with feet silent', 'Perform 20 flagging drills without repositioning')"

Do NOT modify the RequestBody interface, ResponseBody type, or any helper functions.
</action>
  <verify>
grep -A 30 "const systemPrompt" supabase/functions/openrouter-coach/index.ts | grep -E "(technique|movement|body tension|footwork)" | head -5
</verify>
  <done>System prompt focuses on technique with strength→technique reframing examples</done>
</task>

<task type="auto">
  <name>Task 2: Update validateResponse to include measurable_outcome</name>
  <files>supabase/functions/openrouter-coach/index.ts</files>
  <action>
Update the validateResponse function to add measurable_outcome field validation:

1. In the drill validation loop (after the existing drill fields), add validation for measurable_outcome
2. Add check: `if (!drill.measurable_outcome || typeof drill.measurable_outcome !== 'string')`
3. Throw error: `throw new Error(\`Drill ${drillNum}: Missing or invalid field: measurable_outcome\`)`
4. Add check: `if (drill.measurable_outcome.trim().length < 10)`
5. Throw error: `throw new Error(\`Drill ${drillNum}: Field measurable_outcome must be at least 10 characters\`)`

This ensures each drill has a concrete, measurable outcome for progress tracking.

The measurable_outcome field should come AFTER all existing drill field validations (name, description, sets, reps, rest).

Do NOT modify any other validation logic (weekly_focus, drill array length, existing drill fields).
</action>
  <verify>grep -A 3 "measurable_outcome" supabase/functions/openrouter-coach/index.ts | grep "throw new Error"</verify>
  <done>validateResponse checks for measurable_outcome field with min length 10</done>
</task>

</tasks>

<verification>
- [ ] System prompt focuses on technique (not strength)
- [ ] Strength failures are reframed as technique gaps
- [ ] Drill terminology examples are technique-focused
- [ ] measurable_outcome field is validated
- [ ] Existing validation for other drill fields remains intact
- [ ] Edge Function can still be deployed (no syntax errors)
</verification>

<success_criteria>
System prompt emphasizes technique coaching with strength→technique reframing; drill validation includes measurable_outcome field with proper constraints.
</success_criteria>

<output>
After completion, create `.planning/phases/23-refocus-coach-on-technique/23-02-SUMMARY.md`
</output>
