---
phase: 21-chat-interface
plan: 05
type: execute
wave: 3
depends_on: [21-03]
files_modified:
  - src/components/features/chat-page.tsx
autonomous: true
user_setup: []

must_haves:
  truths:
    - "Loading state shows skeleton or spinner when messages are loading"
    - "Error message displays below input when streaming fails"
    - "Error message is user-friendly (e.g., 'Connection lost', 'Try again')"
    - "Send button disabled while streaming (visual feedback)"
    - "Input field disabled while streaming (prevents duplicate sends)"
    - "Empty state shows helpful message when no messages exist"
    - "Mobile touch targets meet 44px minimum (send button, input field)"
  artifacts:
    - path: "src/components/features/chat-page.tsx"
      provides: "Polished chat interface with loading states and error handling"
      min_lines: 150
  key_links:
    - from: "src/components/features/chat-page.tsx"
      to: "Loading state"
      via: "useCoachMessages.isLoading"
      pattern: "isLoading.*\\?|Loading messages"
    - from: "src/components/features/chat-page.tsx"
      to: "Error display"
      via: "useStreamingChat.error"
      pattern: "error.*\\?|error.*message"
---

<objective>
Add loading states, error handling, and visual polish to chat interface.

Purpose: Provide smooth UX with loading indicators, helpful error messages, and mobile-optimized visual polish (CHAT-06 requirement).
Output: Enhanced ChatPage component with loading states, error handling, empty state, and polished mobile UI.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/ROADMAP.md
@src/components/features/chat-page.tsx
@src/components/ui/error-banner.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Enhance ChatPage with loading states and error handling</name>
  <files>src/components/features/chat-page.tsx</files>
  <action>
    Update src/components/features/chat-page.tsx with:

    1. Loading state enhancement:
       - If isLoading (useCoachMessages loading):
         - Render skeleton UI or centered spinner
         - Use: <div className="text-center py-12 text-[#888]">Loading messages...</div>
         - Or create skeleton bubbles (2-3 placeholder bubbles with pulsing animation)

    2. Empty state enhancement:
       - If messages loaded and messages.length === 0 and no streamingResponse:
         - Render helpful empty state message
         - Example: <div className="text-center py-12 text-[#888]"><p className="text-sm mb-2">No messages yet</p><p className="text-xs font-mono">Ask Coach about technique, beta, or training</p></div>

    3. Error handling enhancement:
       - If error state is not null:
         - Render error message below input container
         - Style: <div className="mt-2 text-xs text-red-400 flex items-center gap-2"><span>{error}</span></div>
         - Add "Retry" button for common errors (network, timeout)
         - Retry button: onClick={() => { setError(null); /* resend last message */ }}
         - Button style: ml-2 text-xs text-blue-400 underline

    4. Input disabled visual feedback:
       - Textarea: add className condition based on isStreaming
         - If isStreaming: add "opacity-50 cursor-not-allowed"
       - Button: already disabled, but ensure visual opacity: disabled={...} automatically handles this

    5. Mobile touch target verification:
       - Send button: h-[44px] w-[44px] (already specified in plan 21-03)
       - Textarea: min-h-[44px] (already specified in plan 21-03)
       - Retry button: min-h-[44px] if added for retry action

    6. Smooth transitions:
       - Add transition classes to buttons and input
       - Example: transition-all duration-200 on Button and Textarea
       - Add hover state smoothing: hover:bg-white/90, hover:border-white/40

    7. Typing indicator polish:
       - Ensure animation is smooth (animate-bounce with staggered delays)
       - Add "Coach is thinking..." text as already specified
       - Consider adding small icon (e.g., Brain or MessageSquare icon next to text)

    8. Message bubble polish:
       - Add subtle shadows for depth: shadow-lg
       - Ensure text wraps correctly: whitespace-pre-wrap
       - Add hover effects: slight brightness increase

    Reference existing ErrorBanner component from src/components/ui/error-banner.tsx for error display pattern.
  </action>
  <verify>
    Check chat-page.tsx contains loading state display, empty state message, error message display below input, and disabled visual states for isStreaming.
  </verify>
  <done>
    Chat interface enhanced with loading states, error handling, empty state, and mobile-optimized visual polish
  </done>
</task>

</tasks>

<verification>
Overall phase checks:
- Loading state shows when messages are loading
- Empty state displays helpful message for new users
- Error message displays below input with helpful text
- Send button and input field visually disabled while streaming
- Retry mechanism provided for common errors
- Mobile touch targets meet 44px minimum
- Transitions and hover effects provide smooth UX
</verification>

<success_criteria>
Chat interface polished with loading states, error handling, empty state, and mobile-optimized visual feedback
</success_criteria>

<output>
After completion, create `.planning/phases/21-chat-interface/21-05-SUMMARY.md`
</output>
