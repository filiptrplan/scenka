# Roadmap: Scenka v2.1

**Milestone:** Simplified Logging + AI Auto-Tagging
**Created:** 2026-01-20
**Depth:** Quick (4 phases, critical path focus)

---

## Overview

Transform climb logging from a multi-select decision process to a frictionless notes-first experience. Users log climbs with minimal fields (grade, outcome, terrain, awkwardness, notes) while AI extracts structured tags in the background. The async architecture ensures offline-first behavior, cost control protects against runaway API expenses, and human-in-the-loop confirmation maintains user trust. Four tightly-scoped phases deliver foundation, extraction, display, and integration.

---

## Phase 30: Simplified Logger Foundation

**Goal:** Users can log climbs quickly with reduced friction using a simplified form that eliminates manual tag selection.

**Dependencies:** None

**Requirements:**
- SIMP-01: User can log climb with grade scale and grade value
- SIMP-02: User can log climb with outcome (Sent/Fail)
- SIMP-03: User can log climb with terrain type from 8 options
- SIMP-04: User can log climb with awkwardness (3 options: awkward/normal/smooth)
- SIMP-05: User can log climb with free-form notes (primary data source)
- SIMP-06: Logger form does NOT include manual style tags selector
- SIMP-07: Logger form does NOT include manual failure reasons selector
- SIMP-08: Form validates all required fields before submission
- SIMP-09: Form auto-resets after successful submission (preserve v1.1 behavior)

**Success Criteria:**
1. User can complete climb logging in under 15 seconds by filling 5 fields (grade, outcome, terrain, awkwardness, notes)
2. Form prevents submission with missing required fields and shows clear validation errors
3. Form automatically clears all fields after successful submission without user action
4. Form does NOT display style tags or failure reason selectors anywhere in the UI
5. Notes field accepts multi-line free-form text without character limits

**Plans:**
- Create simplified logger component with 5-field form
- Implement terrain type picker (8 options: Slab, Vert, Overhang, Roof, Dyno, Crimp, Sloper, Pinch)
- Implement simplified awkwardness picker (3 options: awkward/normal/smooth)
- Add form validation with Zod schema for required fields
- Remove manual tag selectors from existing logger component
- Preserve form auto-reset behavior from v1.1
- Test logger flow on mobile devices
- Update logger to preserve existing grade scale and outcome fields

---

## Phase 31: AI Tag Extraction Service

**Goal:** System asynchronously extracts structured tags from notes using AI while enforcing cost controls and protecting user privacy.

**Dependencies:** Phase 30 (Simplified Logger Foundation)

**Requirements:**
- EXTR-01: System extracts styles from notes on climb save
- EXTR-02: System extracts failure reasons from notes on climb save
- EXTR-03: Tag extraction happens asynchronously (non-blocking save flow)
- EXTR-04: Climb saves immediately, tags appear after extraction completes
- EXTR-05: System tracks AI extraction costs per user in user_limits table
- EXTR-06: System enforces per-user tag extraction quota (50 climbs/day default)
- EXTR-07: Extraction completes within 3 seconds on online device with good connectivity
- EXTR-08: Extraction fails gracefully if AI service unavailable (no crash, user informed)

**Success Criteria:**
1. User sees climb saved immediately, followed by "Extracting tags..." indicator that resolves within 3 seconds
2. System extracts correct tags from clear notes with 80%+ accuracy (styles and failure reasons)
3. System prevents extraction after reaching 50 climbs per day quota and shows quota exceeded message
4. System tracks token usage and cost per user in user_limits table
5. System shows user-friendly error message when AI service is unavailable without crashing app

**Plans:**
- Create database schema migration (tags_pending_sync column to climbs table)
- Create openrouter-tag-extractor Edge Function (reuse auth from openrouter-coach)
- Implement PII detection and anonymization before API calls
- Implement TagService layer with createClimbWithTags and extractTagsAsync functions
- Add cost tracking columns to user_limits table
- Implement per-user quota enforcement with daily reset logic
- Add extraction error handling with user-friendly messages
- Test extraction with sample climbing notes and measure accuracy

---

## Phase 32: Tag Display & Editing

**Goal:** Users can review, edit, and confirm AI-extracted tags with full control over final tag selection.

**Dependencies:** Phase 31 (AI Tag Extraction Service)

**Requirements:**
- DISP-01: System displays extracted tags grouped separately (styles, failure reasons)
- DISP-02: User can remove extracted tag with single tap
- DISP-03: User can add available tags with single tap from list
- DISP-04: User can manually add tags AI missed
- DISP-05: User can manually remove tags AI extracted incorrectly
- DISP-06: Tag changes require user confirmation (save button prevents accidental removal)

**Success Criteria:**
1. User sees extracted tags displayed in two clearly labeled groups (styles, failure reasons)
2. User can remove any tag with single tap
3. User can add any available tag to their climb with single tap
4. User can type and add custom tags not in standard list
5. User must confirm tag changes with explicit save button (no auto-save on individual edits)
6. Tag display updates immediately after confirmation without page reload

**Plans:**
- Create TagConfirmationDialog component to display extracted tags
- Implement grouped tag display (styles vs failure reasons)
- Add single-tap tag removal functionality
- Create tag picker component for adding available tags
- Add manual tag entry input for custom tags
- Implement save confirmation button for tag changes
- Add optimistic UI updates for tag edits
- Test tag editing flow on mobile with various tag combinations

---

## Phase 33: Offline Support & Analytics Integration

**Goal:** System handles offline climbing scenarios and displays AI-extracted tags in analytics dashboards.

**Dependencies:** Phase 32 (Tag Display & Editing)

**Requirements:**
- OFFL-01: User can save climb when offline (AI extraction queued)
- OFFL-02: System queues climbs for AI extraction when saved offline
- OFFL-03: System shows "Saved (offline)" message when device has no connectivity
- OFFL-04: System processes queued extractions when device regains connectivity
- OFFL-05: System updates tags with AI-extracted results after sync
- ANAL-01: Training Priorities chart displays AI-extracted failure reasons
- ANAL-02: Style Weaknesses analysis displays AI-extracted styles
- ANAL-03: Pattern analysis processes AI-extracted tags correctly
- ANAL-04: Analytics queries work unchanged with AI-extracted tags

**Success Criteria:**
1. User can save climbs when offline with no error, app shows "Saved (offline)" message
2. System shows all climbs saved offline are processed for tagging when device reconnects
3. User sees tags appear on offline-saved climbs after sync completes
4. Training Priorities chart displays failure reason breakdown from AI-extracted tags
5. Style Weaknesses analysis displays style distribution from AI-extracted tags
6. Pattern analysis shows insights based on AI-extracted tags without code changes

**Plans:**
- Extend offline queue with tags_pending_sync flag
- Implement offline save detection with connectivity check
- Add offline save status indicator ("Saved (offline)")
- Implement retroactive tagging job for offline queue processing
- Update Training Priorities chart to use AI-extracted failure_reasons
- Update Style Weaknesses analysis to use AI-extracted styles
- Verify pattern analysis queries work with AI-extracted tags
- Test full offline-to-online sync flow with tag extraction

---

## Progress

| Phase | Status | Complete | Plans |
|-------|--------|----------|-------|
| 30 - Simplified Logger Foundation | Not Started | 0/9 | 0/8 |
| 31 - AI Tag Extraction Service | Not Started | 0/8 | 0/8 |
| 32 - Tag Display & Editing | Not Started | 0/6 | 0/7 |
| 33 - Offline Support & Analytics Integration | Not Started | 0/9 | 0/8 |

**Overall:** 0/32 requirements complete (0%)

---

*Last updated: 2026-01-20 after roadmap creation*
